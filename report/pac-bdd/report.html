<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title id="head-title">report.html</title>
      <style type="text/css">body {
  font-family: Helvetica, Arial, sans-serif;
  font-size: 12px;
  /* do not increase min-width as some may use split screens */
  min-width: 800px;
  color: #999;
}

h1 {
  font-size: 24px;
  color: black;
}

h2 {
  font-size: 16px;
  color: black;
}

p {
  color: black;
}

a {
  color: #999;
}

table {
  border-collapse: collapse;
}

/******************************
 * SUMMARY INFORMATION
 ******************************/
#environment td {
  padding: 5px;
  border: 1px solid #e6e6e6;
  vertical-align: top;
}
#environment tr:nth-child(odd) {
  background-color: #f6f6f6;
}
#environment ul {
  margin: 0;
  padding: 0 20px;
}

/******************************
 * TEST RESULT COLORS
 ******************************/
span.passed,
.passed .col-result {
  color: green;
}

span.skipped,
span.xfailed,
span.rerun,
.skipped .col-result,
.xfailed .col-result,
.rerun .col-result {
  color: orange;
}

span.error,
span.failed,
span.xpassed,
.error .col-result,
.failed .col-result,
.xpassed .col-result {
  color: red;
}

.col-links__extra {
  margin-right: 3px;
}

/******************************
 * RESULTS TABLE
 *
 * 1. Table Layout
 * 2. Extra
 * 3. Sorting items
 *
 ******************************/
/*------------------
 * 1. Table Layout
 *------------------*/
#results-table {
  border: 1px solid #e6e6e6;
  color: #999;
  font-size: 12px;
  width: 100%;
}
#results-table th,
#results-table td {
  padding: 5px;
  border: 1px solid #e6e6e6;
  text-align: left;
}
#results-table th {
  font-weight: bold;
}

/*------------------
 * 2. Extra
 *------------------*/
.logwrapper {
  max-height: 230px;
  overflow-y: scroll;
  background-color: #e6e6e6;
}
.logwrapper.expanded {
  max-height: none;
}
.logwrapper.expanded .logexpander:after {
  content: "collapse [-]";
}
.logwrapper .logexpander {
  z-index: 1;
  position: sticky;
  top: 10px;
  width: max-content;
  border: 1px solid;
  border-radius: 3px;
  padding: 5px 7px;
  margin: 10px 0 10px calc(100% - 80px);
  cursor: pointer;
  background-color: #e6e6e6;
}
.logwrapper .logexpander:after {
  content: "expand [+]";
}
.logwrapper .logexpander:hover {
  color: #000;
  border-color: #000;
}
.logwrapper .log {
  min-height: 40px;
  position: relative;
  top: -50px;
  height: calc(100% + 50px);
  border: 1px solid #e6e6e6;
  color: black;
  display: block;
  font-family: "Courier New", Courier, monospace;
  padding: 5px;
  padding-right: 80px;
  white-space: pre-wrap;
}

div.media {
  border: 1px solid #e6e6e6;
  float: right;
  height: 240px;
  margin: 0 5px;
  overflow: hidden;
  width: 320px;
}

.media-container {
  display: grid;
  grid-template-columns: 25px auto 25px;
  align-items: center;
  flex: 1 1;
  overflow: hidden;
  height: 200px;
}

.media-container--fullscreen {
  grid-template-columns: 0px auto 0px;
}

.media-container__nav--right,
.media-container__nav--left {
  text-align: center;
  cursor: pointer;
}

.media-container__viewport {
  cursor: pointer;
  text-align: center;
  height: inherit;
}
.media-container__viewport img,
.media-container__viewport video {
  object-fit: cover;
  width: 100%;
  max-height: 100%;
}

.media__name,
.media__counter {
  display: flex;
  flex-direction: row;
  justify-content: space-around;
  flex: 0 0 25px;
  align-items: center;
}

.collapsible td:not(.col-links) {
  cursor: pointer;
}
.collapsible td:not(.col-links):hover::after {
  color: #bbb;
  font-style: italic;
  cursor: pointer;
}

.col-result {
  width: 130px;
}
.col-result:hover::after {
  content: " (hide details)";
}

.col-result.collapsed:hover::after {
  content: " (show details)";
}

#environment-header h2:hover::after {
  content: " (hide details)";
  color: #bbb;
  font-style: italic;
  cursor: pointer;
  font-size: 12px;
}

#environment-header.collapsed h2:hover::after {
  content: " (show details)";
  color: #bbb;
  font-style: italic;
  cursor: pointer;
  font-size: 12px;
}

/*------------------
 * 3. Sorting items
 *------------------*/
.sortable {
  cursor: pointer;
}
.sortable.desc:after {
  content: " ";
  position: relative;
  left: 5px;
  bottom: -12.5px;
  border: 10px solid #4caf50;
  border-bottom: 0;
  border-left-color: transparent;
  border-right-color: transparent;
}
.sortable.asc:after {
  content: " ";
  position: relative;
  left: 5px;
  bottom: 12.5px;
  border: 10px solid #4caf50;
  border-top: 0;
  border-left-color: transparent;
  border-right-color: transparent;
}

.hidden, .summary__reload__button.hidden {
  display: none;
}

.summary__data {
  flex: 0 0 550px;
}
.summary__reload {
  flex: 1 1;
  display: flex;
  justify-content: center;
}
.summary__reload__button {
  flex: 0 0 300px;
  display: flex;
  color: white;
  font-weight: bold;
  background-color: #4caf50;
  text-align: center;
  justify-content: center;
  align-items: center;
  border-radius: 3px;
  cursor: pointer;
}
.summary__reload__button:hover {
  background-color: #46a049;
}
.summary__spacer {
  flex: 0 0 550px;
}

.controls {
  display: flex;
  justify-content: space-between;
}

.filters,
.collapse {
  display: flex;
  align-items: center;
}
.filters button,
.collapse button {
  color: #999;
  border: none;
  background: none;
  cursor: pointer;
  text-decoration: underline;
}
.filters button:hover,
.collapse button:hover {
  color: #ccc;
}

.filter__label {
  margin-right: 10px;
}

      </style>
    
  </head>
  <body>
    <h1 id="title">report.html</h1>
    <p>Report generated on 14-Jan-2026 at 23:13:21 by <a href="https://pypi.python.org/pypi/pytest-html">pytest-html</a>
        v4.1.1</p>
    <div id="environment-header">
      <h2>Environment</h2>
    </div>
    <table id="environment"></table>
    <!-- TEMPLATES -->
      <template id="template_environment_row">
      <tr>
        <td></td>
        <td></td>
      </tr>
    </template>
    <template id="template_results-table__body--empty">
      <tbody class="results-table-row">
        <tr id="not-found-message">
          <td colspan="4">No results found. Check the filters.</th>
        </tr>
    </template>
    <template id="template_results-table__tbody">
      <tbody class="results-table-row">
        <tr class="collapsible">
        </tr>
        <tr class="extras-row">
          <td class="extra" colspan="4">
            <div class="extraHTML"></div>
            <div class="media">
              <div class="media-container">
                  <div class="media-container__nav--left"><</div>
                  <div class="media-container__viewport">
                    <img src="" />
                    <video controls>
                      <source src="" type="video/mp4">
                    </video>
                  </div>
                  <div class="media-container__nav--right">></div>
                </div>
                <div class="media__name"></div>
                <div class="media__counter"></div>
            </div>
            <div class="logwrapper">
              <div class="logexpander"></div>
              <div class="log"></div>
            </div>
          </td>
        </tr>
      </tbody>
    </template>
    <!-- END TEMPLATES -->
    <div class="summary">
      <div class="summary__data">
        <h2>Summary</h2>
        <div class="additional-summary prefix">
        </div>
        <p class="run-count">66 tests took 00:00:17.</p>
        <p class="filter">(Un)check the boxes to filter the results.</p>
        <div class="summary__reload">
          <div class="summary__reload__button hidden" onclick="location.reload()">
            <div>There are still tests running. <br />Reload this page to get the latest results!</div>
          </div>
        </div>
        <div class="summary__spacer"></div>
        <div class="controls">
          <div class="filters">
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="failed" />
            <span class="failed">55 Failed,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="passed" />
            <span class="passed">11 Passed,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="skipped" disabled/>
            <span class="skipped">0 Skipped,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="xfailed" disabled/>
            <span class="xfailed">0 Expected failures,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="xpassed" disabled/>
            <span class="xpassed">0 Unexpected passes,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="error" disabled/>
            <span class="error">0 Errors,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="rerun" disabled/>
            <span class="rerun">0 Reruns</span>
          </div>
          <div class="collapse">
            <button id="show_all_details">Show all details</button>&nbsp;/&nbsp;<button id="hide_all_details">Hide all details</button>
          </div>
        </div>
      </div>
      <div class="additional-summary summary">
      </div>
      <div class="additional-summary postfix">
      </div>
    </div>
    <table id="results-table">
      <thead id="results-table-head">
        <tr>
          <th class="sortable" data-column-type="result">Result</th>
          <th class="sortable" data-column-type="testId">Test</th>
          <th class="sortable" data-column-type="duration">Duration</th>
          <th>Links</th>
        </tr>
      </thead>
    </table>
  </body>
  <footer>
    <div id="data-container" data-jsonblob="{&#34;environment&#34;: {&#34;Python&#34;: &#34;3.13.2&#34;, &#34;Platform&#34;: &#34;Linux-6.8.0-90-generic-x86_64-with-glibc2.39&#34;, &#34;Packages&#34;: {&#34;pytest&#34;: &#34;8.4.2&#34;, &#34;pluggy&#34;: &#34;1.6.0&#34;}, &#34;Plugins&#34;: {&#34;html&#34;: &#34;4.1.1&#34;, &#34;bdd&#34;: &#34;8.1.0&#34;, &#34;metadata&#34;: &#34;3.1.1&#34;, &#34;asyncio&#34;: &#34;1.3.0&#34;, &#34;md-report&#34;: &#34;0.7.0&#34;, &#34;anyio&#34;: &#34;4.12.0&#34;}}, &#34;tests&#34;: {&#34;test_fixture.py::test_dummy_fixture&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_fixture.py::test_dummy_fixture&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_fixture.py::test_dummy_fixture&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;No log output captured.&#34;}], &#34;test_fixture.py::test_dummy_async_fixture&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_fixture.py::test_dummy_async_fixture&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_fixture.py::test_dummy_async_fixture&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log setup ------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n&#34;}], &#34;test_openapi.py::test_swagger_flow_service&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_openapi.py::test_swagger_flow_service&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_openapi.py::test_swagger_flow_service&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;def test_swagger_flow_service():\n        url = &amp;#x27;???&amp;#x27;\n&amp;gt;       _test_swagger(\n            url,\n            &amp;quot;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE A - PR XP Z12-013 - AFNOR-Flow_Service-1.1.0-swagger.json&amp;quot;,\n        )\n\ntest_openapi.py:24: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nurl = &amp;#x27;???&amp;#x27;, swagger = &amp;#x27;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE A - PR XP Z12-013 - AFNOR-Flow_Service-1.1.0-swagger.json&amp;#x27;\n\n    def _test_swagger(url: str, swagger: str):\n        &amp;quot;&amp;quot;&amp;quot;\n            V\u00e9rifier si une API respecte une definition Swagger/OpenAPI\n    \n        Cette API doit respecter le versioning indiqu\u00e9 dans l\u2019URL de la route API du Swagger. Dans un objectif de\n        simplification le versioning des routes n\u2019est pas affich\u00e9 dans le pr\u00e9sent document;\n        Dans cette API publi\u00e9e par le Fournisseur API ce dernier peut :\n        \u2022Avoir une URL sp\u00e9cifique en amont du versioning\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les requ\u00eates.\n        \u2022Ajouter des param\u00e8tres aux routes dans les requ\u00eates.\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les r\u00e9ponses.\n        \u2022Ajouter des codes erreurs dans les r\u00e9ponses.\n        &amp;quot;&amp;quot;&amp;quot;\n&amp;gt;       raise NotImplementedError(&amp;quot;swagger compliance non test\u00e9&amp;quot;)\nE       NotImplementedError: swagger compliance non test\u00e9\n\ntest_openapi.py:18: NotImplementedError\n&#34;}], &#34;test_openapi.py::test_swagger_directory_service&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_openapi.py::test_swagger_directory_service&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_openapi.py::test_swagger_directory_service&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;def test_swagger_directory_service():\n        url = &amp;quot;???&amp;quot;\n&amp;gt;       _test_swagger(\n            url,\n            &amp;quot;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE B - PR XP Z12-013 - AFNOR-Directory_Service-1.1.0-swagger.json&amp;quot;,\n        )\n\ntest_openapi.py:32: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nurl = &amp;#x27;???&amp;#x27;, swagger = &amp;#x27;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE B - PR XP Z12-013 - AFNOR-Directory_Service-1.1.0-swagger.json&amp;#x27;\n\n    def _test_swagger(url: str, swagger: str):\n        &amp;quot;&amp;quot;&amp;quot;\n            V\u00e9rifier si une API respecte une definition Swagger/OpenAPI\n    \n        Cette API doit respecter le versioning indiqu\u00e9 dans l\u2019URL de la route API du Swagger. Dans un objectif de\n        simplification le versioning des routes n\u2019est pas affich\u00e9 dans le pr\u00e9sent document;\n        Dans cette API publi\u00e9e par le Fournisseur API ce dernier peut :\n        \u2022Avoir une URL sp\u00e9cifique en amont du versioning\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les requ\u00eates.\n        \u2022Ajouter des param\u00e8tres aux routes dans les requ\u00eates.\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les r\u00e9ponses.\n        \u2022Ajouter des codes erreurs dans les r\u00e9ponses.\n        &amp;quot;&amp;quot;&amp;quot;\n&amp;gt;       raise NotImplementedError(&amp;quot;swagger compliance non test\u00e9&amp;quot;)\nE       NotImplementedError: swagger compliance non test\u00e9\n\ntest_openapi.py:18: NotImplementedError\n&#34;}], &#34;test_pac0.py::test_pac0_import_services&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_pac0.py::test_pac0_import_services&#34;, &#34;duration&#34;: &#34;23 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_pac0.py::test_pac0_import_services&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;23 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;+ Exception Group Traceback (most recent call last):\n  |   File &amp;quot;/home/philippe/src/PA_Communautaire/packages/pac-bdd/test_pac0.py&amp;quot;, line 21, in test_pac0_import_services\n  |     async with asyncio.TaskGroup() as tg:\n  |                ~~~~~~~~~~~~~~~~~^^\n  |   File &amp;quot;/home/philippe/.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/taskgroups.py&amp;quot;, line 71, in __aexit__\n  |     return await self._aexit(et, exc)\n  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  |   File &amp;quot;/home/philippe/.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/taskgroups.py&amp;quot;, line 173, in _aexit\n  |     raise BaseExceptionGroup(\n  |     ...&amp;lt;2 lines&amp;gt;...\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File &amp;quot;/home/philippe/src/PA_Communautaire/packages/pac-bdd/test_pac0.py&amp;quot;, line 22, in test_pac0_import_services\n    |     task1 = tg.create_task(api_gateway_main.app.run())\n    |                            ^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: &amp;#x27;FastAPI&amp;#x27; object has no attribute &amp;#x27;run&amp;#x27;\n    +------------------------------------\n\n------------------------------ Captured log setup ------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n\n----------------------------- Captured stdout call -----------------------------\nConnecting to NATS nats://localhost:4222 ...\nConnecting to NATS nats://localhost:4222 ...\nConnecting to NATS nats://localhost:4222 ...\n&#34;}], &#34;test_scenario.py::test_simpliste_avec_commentaire&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_simpliste_avec_commentaire&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_simpliste_avec_commentaire&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais quelque chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais quelque chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;ai fait 4 choses&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;ai fait {nb} choses&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_simpliste&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_simpliste&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_simpliste&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function it_works at 0x749ae9575ee0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_simpliste&amp;gt;&amp;gt;, kwargs = {&amp;#x27;nb&amp;#x27;: &amp;#x27;4&amp;#x27;}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nnb = &amp;#x27;4&amp;#x27;\n\n    @then(parsers.parse(&amp;quot;&amp;quot;&amp;quot;j&amp;#x27;ai fait {nb} choses&amp;quot;&amp;quot;&amp;quot;))\n    def it_works(nb):\n        # si le nombre donn\u00e9e `nb` ne corresponds pas au contexte, on \u00e9choue\n&amp;gt;       assert ctx[&amp;#x27;nb&amp;#x27;] == int(nb)\n               ^^^^^^^^^^^^^^^^^^^^\nE       AssertionError\n\nsrc/pac_bdd/demo.py:31: AssertionError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais quelque chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais quelque chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;ai fait 4 choses&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;ai fait {nb} choses&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_trackingid_fourni&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_trackingid_fourni&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_trackingid_fourni&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 13 in scenario &amp;quot;trackingId fourni&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/trackingId.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\nppppppp port 9094 OK\nppppppp port 8825 OK\nppppppp port 8734 OK\n_check_http_health http://localhost:8734/healthcheck\nppppppp port 9168 OK\nppppppp port 8738 OK\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8825 ...\n2026-01-14 23:13:04,514 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 23:13:04,515 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8825 ...\n2026-01-14 23:13:04,527 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-14 23:13:04,528 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8825 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8734\n    server   Documentation at http://0.0.0.0:8734/docs\n \n             Logs:\n \n2026-01-14 23:13:04,666 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 23:13:04,666 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8734/healthcheck\n      INFO   127.0.0.1:58446 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:58454 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[16877] 2026/01/14 23:13:04.209937 [INF] Starting nats-server\n[16877] 2026/01/14 23:13:04.210010 [INF]   Version:  2.12.3\n[16877] 2026/01/14 23:13:04.210015 [INF]   Git:      [450a519]\n[16877] 2026/01/14 23:13:04.210019 [INF]   Name:     NCYYF7237UZR7TY4THAM3ZNKN5V7YJ36WZQ6FHQBQEQXZN2YPYDA4WN7\n[16877] 2026/01/14 23:13:04.210023 [INF]   ID:       NCYYF7237UZR7TY4THAM3ZNKN5V7YJ36WZQ6FHQBQEQXZN2YPYDA4WN7\n[16877] 2026/01/14 23:13:04.210772 [INF] Listening for client connections on 0.0.0.0:8825\n[16877] 2026/01/14 23:13:04.211041 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 23:13:04,511 INFO     - FastStream app starting...\n2026-01-14 23:13:04,515 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 23:13:04,524 INFO     - FastStream app starting...\n2026-01-14 23:13:04,528 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [16893]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8734 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 9094 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  peppol started on localhost:9094\nINFO     pac0.shared.test.world:world.py:87 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8825 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  esb_central started on localhost:8825\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8734 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 9168 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  controle_formats started on localhost:9168\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8738 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  routage started on localhost:8738\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8734 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8734 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x749ae92a6660&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 22:13:04 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8734/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:162 Service  api_gateway started on localhost:8734\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8734 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x749ae900c050&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 22:13:04 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8734/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [16893]\n2026-01-14 23:13:05,717 INFO     - FastStream app shutting down...\n2026-01-14 23:13:05,718 INFO     - FastStream app shut down gracefully.\n2026-01-14 23:13:05,933 INFO     - FastStream app shutting down...\n2026-01-14 23:13:05,935 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.world:world.py:95 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_trackingid_absent&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_trackingid_absent&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_trackingid_absent&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 23 in scenario &amp;quot;trackingId absent&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/trackingId.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\nppppppp port 8416 OK\nppppppp port 8421 OK\nppppppp port 8666 OK\n_check_http_health http://localhost:8666/healthcheck\nppppppp port 9114 OK\nppppppp port 8431 OK\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8421 ...\n2026-01-14 23:13:06,640 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 23:13:06,640 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8421 ...\n2026-01-14 23:13:06,645 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-14 23:13:06,645 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8421 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8666\n    server   Documentation at http://0.0.0.0:8666/docs\n \n             Logs:\n \n2026-01-14 23:13:06,852 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 23:13:06,853 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8666/healthcheck\n      INFO   127.0.0.1:33292 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:33302 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[16920] 2026/01/14 23:13:06.088869 [INF] Starting nats-server\n[16920] 2026/01/14 23:13:06.089223 [INF]   Version:  2.12.3\n[16920] 2026/01/14 23:13:06.089228 [INF]   Git:      [450a519]\n[16920] 2026/01/14 23:13:06.089232 [INF]   Name:     NCPP3MJBBVQHKLQZ64QZTWL7M7GNNV5VDG6ZWG2GUCGJVUTOSKAGOHIP\n[16920] 2026/01/14 23:13:06.089236 [INF]   ID:       NCPP3MJBBVQHKLQZ64QZTWL7M7GNNV5VDG6ZWG2GUCGJVUTOSKAGOHIP\n[16920] 2026/01/14 23:13:06.089930 [INF] Listening for client connections on 0.0.0.0:8421\n[16920] 2026/01/14 23:13:06.090346 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 23:13:06,635 INFO     - FastStream app starting...\n2026-01-14 23:13:06,640 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 23:13:06,641 INFO     - FastStream app starting...\n2026-01-14 23:13:06,646 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [16938]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8666 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8416 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  peppol started on localhost:8416\nINFO     pac0.shared.test.world:world.py:87 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8421 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  esb_central started on localhost:8421\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8666 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 9114 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  controle_formats started on localhost:9114\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8431 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  routage started on localhost:8431\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8666 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8666 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x749ae9006710&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 22:13:06 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8666/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:162 Service  api_gateway started on localhost:8666\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8666 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x749ae902c190&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 22:13:06 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8666/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [16938]\n2026-01-14 23:13:07,438 INFO     - FastStream app shutting down...\n2026-01-14 23:13:07,439 INFO     - FastStream app shut down gracefully.\n2026-01-14 23:13:07,646 INFO     - FastStream app shutting down...\n2026-01-14 23:13:07,647 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.world:world.py:95 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_trackingid_doublon&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_trackingid_doublon&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_trackingid_doublon&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 32 in scenario &amp;quot;trackingId doublon&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/trackingId.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\nppppppp port 8852 OK\nppppppp port 8970 OK\nppppppp port 9115 OK\n_check_http_health http://localhost:9115/healthcheck\nppppppp port 9297 OK\nppppppp port 9218 OK\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8970 ...\n2026-01-14 23:13:08,341 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 23:13:08,342 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8970 ...\n2026-01-14 23:13:08,355 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-14 23:13:08,355 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8970 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:9115\n    server   Documentation at http://0.0.0.0:9115/docs\n \n             Logs:\n \n2026-01-14 23:13:08,577 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 23:13:08,577 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:9115/healthcheck\n      INFO   127.0.0.1:34658 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:34666 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[16964] 2026/01/14 23:13:07.801564 [INF] Starting nats-server\n[16964] 2026/01/14 23:13:07.801661 [INF]   Version:  2.12.3\n[16964] 2026/01/14 23:13:07.801666 [INF]   Git:      [450a519]\n[16964] 2026/01/14 23:13:07.801670 [INF]   Name:     NBVWSGOU43XYEEO2FDD4BTTUAYB5W4HTOGYCFJCLTRAYULRNM5TSTT7U\n[16964] 2026/01/14 23:13:07.801681 [INF]   ID:       NBVWSGOU43XYEEO2FDD4BTTUAYB5W4HTOGYCFJCLTRAYULRNM5TSTT7U\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[16964] 2026/01/14 23:13:07.802322 [INF] Listening for client connections on 0.0.0.0:8970\n[16964] 2026/01/14 23:13:07.802805 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 23:13:08,337 INFO     - FastStream app starting...\n2026-01-14 23:13:08,342 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 23:13:08,351 INFO     - FastStream app starting...\n2026-01-14 23:13:08,355 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [16979]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:9115 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8852 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  peppol started on localhost:8852\nINFO     pac0.shared.test.world:world.py:87 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8970 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  esb_central started on localhost:8970\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 9115 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 9297 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  controle_formats started on localhost:9297\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 9218 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  routage started on localhost:9218\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9115 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9115 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x749ae9007890&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 22:13:08 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:9115/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:162 Service  api_gateway started on localhost:9115\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9115 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x749ae9006ad0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 22:13:08 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:9115/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [16979]\n2026-01-14 23:13:09,240 INFO     - FastStream app shutting down...\n2026-01-14 23:13:09,241 INFO     - FastStream app shut down gracefully.\n2026-01-14 23:13:09,453 INFO     - FastStream app shutting down...\n2026-01-14 23:13:09,455 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.world:world.py:95 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_api_gateway&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_api_gateway&#34;, &#34;duration&#34;: &#34;00:00:01&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marragearr\u00eat_service_api_gateway&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:01&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\nppppppp port 8643 OK\nppppppp port 8949 OK\n_check_http_health http://localhost:8949/healthcheck\ncccccc All connection attempts failed\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8643 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8949\n    server   Documentation at http://0.0.0.0:8949/docs\n \n             Logs:\n \n2026-01-14 23:13:10,371 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 23:13:10,371 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8949/healthcheck\n      INFO   127.0.0.1:46166 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[17005] 2026/01/14 23:13:09.587764 [INF] Starting nats-server\n[17005] 2026/01/14 23:13:09.587875 [INF]   Version:  2.12.3\n[17005] 2026/01/14 23:13:09.587884 [INF]   Git:      [450a519]\n[17005] 2026/01/14 23:13:09.587891 [INF]   Name:     NCEZOS6UFBZO2LK4HFOMFRACQP4ZEVGHV62UL2K7QDRHF5MH5544IFLU\n[17005] 2026/01/14 23:13:09.587898 [INF]   ID:       NCEZOS6UFBZO2LK4HFOMFRACQP4ZEVGHV62UL2K7QDRHF5MH5544IFLU\n[17005] 2026/01/14 23:13:09.588677 [INF] Listening for client connections on 0.0.0.0:8643\n[17005] 2026/01/14 23:13:09.589121 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n      INFO   Started server process [17017]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8949 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service None on port 8643 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready None ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  None started on localhost:8643\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;01-api-gateway&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;01-api-gateway&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je lance le service &amp;quot;01-api-gateway&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je lance le service &amp;quot;01-api-gateway&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8949 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8949 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8949 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x749ae901b360&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 22:13:10 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8949/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:162 Service  api_gateway started on localhost:8949\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;01-api-gateway&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;01-api-gateway&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [17017]\n[17005] 2026/01/14 23:13:10.836886 [INF] Trapped &amp;quot;terminated&amp;quot; signal\n[17005] 2026/01/14 23:13:10.837142 [INF] Initiating Shutdown...\n[17005] 2026/01/14 23:13:10.837275 [INF] Server Exiting..\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...&#34;}], &#34;test_scenario.py::test_contr\u00f4le_sha256&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_contr\u00f4le_sha256&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_contr\u00f4le_sha256&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 9 in scenario &amp;quot;Contr\u00f4le sha256&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/sha256.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\nppppppp port 8757 OK\nppppppp port 8706 OK\nppppppp port 8679 OK\n_check_http_health http://localhost:8679/healthcheck\nppppppp port 8791 OK\nppppppp port 8878 OK\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8706 ...\n2026-01-14 23:13:11,420 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-14 23:13:11,420 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8706 ...\n2026-01-14 23:13:11,422 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 23:13:11,422 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8706 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8679\n    server   Documentation at http://0.0.0.0:8679/docs\n \n             Logs:\n \n2026-01-14 23:13:11,615 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 23:13:11,615 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8679/healthcheck\n      INFO   127.0.0.1:51574 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:51582 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[17026] 2026/01/14 23:13:10.859080 [INF] Starting nats-server\n[17026] 2026/01/14 23:13:10.859195 [INF]   Version:  2.12.3\n[17026] 2026/01/14 23:13:10.859202 [INF]   Git:      [450a519]\n[17026] 2026/01/14 23:13:10.859208 [INF]   Name:     NAOXEDIFWKRY7IG552YM3RCJVDMSWY427JETCUFCNQ3UGUY23UFWV4AD\n[17026] 2026/01/14 23:13:10.859213 [INF]   ID:       NAOXEDIFWKRY7IG552YM3RCJVDMSWY427JETCUFCNQ3UGUY23UFWV4AD\n[17026] 2026/01/14 23:13:10.860071 [INF] Listening for client connections on 0.0.0.0:8706\n[17026] 2026/01/14 23:13:10.860508 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 23:13:11,415 INFO     - FastStream app starting...\n2026-01-14 23:13:11,418 INFO     - FastStream app starting...\n2026-01-14 23:13:11,420 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 23:13:11,423 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [17043]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8679 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8757 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  peppol started on localhost:8757\nINFO     pac0.shared.test.world:world.py:87 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8706 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  esb_central started on localhost:8706\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8679 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8791 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  controle_formats started on localhost:8791\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8878 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  routage started on localhost:8878\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8679 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8679 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x749ae9018e90&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 22:13:11 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8679/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:162 Service  api_gateway started on localhost:8679\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8679 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x749ae92eb950&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 22:13:11 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8679/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [17043]\n2026-01-14 23:13:12,322 INFO     - FastStream app shutting down...\n2026-01-14 23:13:12,323 INFO     - FastStream app shut down gracefully.\n2026-01-14 23:13:12,519 INFO     - FastStream app shutting down...\n2026-01-14 23:13:12,521 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.world:world.py:95 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_healthcheck&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_healthcheck&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_healthcheck&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\nppppppp port 9056 OK\nppppppp port 9040 OK\nppppppp port 8604 OK\n_check_http_health http://localhost:8604/healthcheck\nppppppp port 8567 OK\nppppppp port 8314 OK\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:9040 ...\n2026-01-14 23:13:13,222 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 23:13:13,223 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9040 ...\n2026-01-14 23:13:13,237 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-14 23:13:13,237 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:9040 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8604\n    server   Documentation at http://0.0.0.0:8604/docs\n \n             Logs:\n \n2026-01-14 23:13:13,452 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 23:13:13,453 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8604/healthcheck\n      INFO   127.0.0.1:53228 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:53236 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[17069] 2026/01/14 23:13:12.684895 [INF] Starting nats-server\n[17069] 2026/01/14 23:13:12.685258 [INF]   Version:  2.12.3\n[17069] 2026/01/14 23:13:12.685270 [INF]   Git:      [450a519]\n[17069] 2026/01/14 23:13:12.685280 [INF]   Name:     NACPKHLQ3OXC7V2CZONFESUVBKUWC6JJS4CFGINPDRPOIKZXD5WSTXWH\n[17069] 2026/01/14 23:13:12.685308 [INF]   ID:       NACPKHLQ3OXC7V2CZONFESUVBKUWC6JJS4CFGINPDRPOIKZXD5WSTXWH\n[17069] 2026/01/14 23:13:12.686283 [INF] Listening for client connections on 0.0.0.0:9040\n[17069] 2026/01/14 23:13:12.686699 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 23:13:13,218 INFO     - FastStream app starting...\n2026-01-14 23:13:13,223 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 23:13:13,233 INFO     - FastStream app starting...\n2026-01-14 23:13:13,237 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [17088]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8604 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_une pa communautaire&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_une pa communautaire&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 9056 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  peppol started on localhost:9056\nINFO     pac0.shared.test.world:world.py:87 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 9040 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  esb_central started on localhost:9040\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8604 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8567 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  controle_formats started on localhost:8567\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8314 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  routage started on localhost:8314\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8604 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8604 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x749ae9098170&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 22:13:13 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8604/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:162 Service  api_gateway started on localhost:8604\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API GET /healthcheck&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8604 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x749ae9035940&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 22:13:13 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8604/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;obtiens le code de retour 200&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;obtiens le code de retour {code}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [17088]\n2026-01-14 23:13:14,021 INFO     - FastStream app shutting down...\n2026-01-14 23:13:14,022 INFO     - FastStream app shut down gracefully.\n2026-01-14 23:13:14,137 INFO     - FastStream app shutting down...\n2026-01-14 23:13:14,138 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.world:world.py:95 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_healthcheck_deep&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_healthcheck_deep&#34;, &#34;duration&#34;: &#34;00:00:04&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_healthcheck_deep&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:04&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\nppppppp port 8723 OK\nppppppp port 9042 KO [Errno 98] Address already in use\nppppppp port 8769 OK\nppppppp port 8987 OK\n_check_http_health http://localhost:8987/healthcheck\nppppppp port 8516 OK\nppppppp port 9226 OK\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8769 ...\n2026-01-14 23:13:14,816 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-14 23:13:14,817 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8769 ...\n2026-01-14 23:13:14,828 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 23:13:14,829 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8769 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8987\n    server   Documentation at http://0.0.0.0:8987/docs\n \n             Logs:\n \n2026-01-14 23:13:15,033 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 23:13:15,033 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8987/healthcheck\n      INFO   127.0.0.1:60234 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n2026-01-14 23:13:15,445 INFO     - healthcheck      | c012b444-d - Received\n2026-01-14 23:13:15,445 INFO     -   | healthcheck         | c012b444-d - Received\n2026-01-14 23:13:15,445 INFO     - healthcheck      | c012b444-d - Processed\n2026-01-14 23:13:15,445 INFO     -   | healthcheck | c012b444-d - Received\n2026-01-14 23:13:15,446 INFO     -   | healthcheck         | c012b444-d - Processed\n2026-01-14 23:13:15,446 INFO     -   | healthcheck | c012b444-d - Processed\n2026-01-14 23:13:15,446 INFO     - healthcheck_resp | ba4d6727-0 - Received\n2026-01-14 23:13:15,447 INFO     - healthcheck_resp | ba4d6727-0 - Processed\n2026-01-14 23:13:15,447 INFO     - healthcheck_resp | d97cd0a9-6 - Received\n2026-01-14 23:13:15,447 INFO     - healthcheck_resp | d97cd0a9-6 - Processed\n2026-01-14 23:13:15,447 INFO     - healthcheck_resp | 88489c61-f - Received\n2026-01-14 23:13:15,448 INFO     - healthcheck_resp | 88489c61-f - Processed\n      INFO   127.0.0.1:60250 - &amp;quot;GET /healthcheck/deep HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[17111] 2026/01/14 23:13:14.265922 [INF] Starting nats-server\n[17111] 2026/01/14 23:13:14.266039 [INF]   Version:  2.12.3\n[17111] 2026/01/14 23:13:14.266046 [INF]   Git:      [450a519]\n[17111] 2026/01/14 23:13:14.266051 [INF]   Name:     NASQH6OXFKJVHRKJWFIQMWJAHIE5MKLQZV25U7YUU3Z6UJYHR7TIE6UO\n[17111] 2026/01/14 23:13:14.266066 [INF]   ID:       NASQH6OXFKJVHRKJWFIQMWJAHIE5MKLQZV25U7YUU3Z6UJYHR7TIE6UO\n[17111] 2026/01/14 23:13:14.266651 [INF] Listening for client connections on 0.0.0.0:8769\n[17111] 2026/01/14 23:13:14.267121 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 23:13:14,812 INFO     - FastStream app starting...\n2026-01-14 23:13:14,817 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 23:13:14,824 INFO     - FastStream app starting...\n2026-01-14 23:13:14,829 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [17126]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8987 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_une pa communautaire&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_une pa communautaire&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8723 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  peppol started on localhost:8723\nINFO     pac0.shared.test.world:world.py:87 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8769 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  esb_central started on localhost:8769\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8987 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8516 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  controle_formats started on localhost:8516\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 9226 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  routage started on localhost:9226\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8987 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8987 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x749ae92db8a0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 22:13:15 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8987/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:162 Service  api_gateway started on localhost:8987\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API GET /healthcheck/deep&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8987 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x749ae9242690&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 22:13:15 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;64&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8987/healthcheck/deep &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;obtiens le code de retour 200&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;obtiens le code de retour {code}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_la r\u00e9ponse a une cl\u00e9 &amp;quot;healthcheck_resp&amp;quot; avec 3 \u00e9l\u00e9ments&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_la r\u00e9ponse a une cl\u00e9 &amp;quot;{key}&amp;quot; avec {nb} \u00e9l\u00e9ments&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [17126]\n2026-01-14 23:13:17,741 INFO     - FastStream app shutting down...\n2026-01-14 23:13:17,743 INFO     - FastStream app shut down gracefully.\n2026-01-14 23:13:17,932 INFO     - FastStream app shutting down...\n2026-01-14 23:13:17,933 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.world:world.py:95 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_controle_format_facturx&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_controle_format_facturx&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_controle_format_facturx&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function control_invoice at 0x749ae95fac00&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_controle_format_facturx&amp;gt;&amp;gt;, kwargs = {}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @when(\n        parsers.parse(&amp;quot;je d\u00e9pose pour contr\u00f4le la facture @{invoice}&amp;quot;),\n    )\n    def control_invoice():\n&amp;gt;       raise NotImplementedError()\nE       NotImplementedError\n\nsrc/pac_bdd/tobeimplemented.py:30: NotImplementedError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je d\u00e9pose pour contr\u00f4le la facture @FA213746_20251211_124749.pdf&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je d\u00e9pose pour contr\u00f4le la facture @{invoice}&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_serveur_nats&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_serveur_nats&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_serveur_nats&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un serveur NATS disponible&amp;quot;. Line 19 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un serveur NATS&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/service_lifecycle.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_connexion_dun_broker_au_serveur_nats&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_connexion_dun_broker_au_serveur_nats&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_connexion_dun_broker_au_serveur_nats&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un serveur NATS disponible&amp;quot;. Line 23 in scenario &amp;quot;Connexion d&amp;#x27;un broker au serveur NATS&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/service_lifecycle.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_de_plusieurs_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_de_plusieurs_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_de_plusieurs_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;2 PA d\u00e9marr\u00e9es&amp;quot;. Line 32 in scenario &amp;quot;D\u00e9marrage de plusieurs PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/service_lifecycle.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_service_nats_local&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_service_nats_local&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_service_nats_local&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service NATS local&amp;quot;. Line 21 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un service NATS local&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_connexion_\u00e0_un_service_nats_distant&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_connexion_\u00e0_un_service_nats_distant&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_connexion_\u00e0_un_service_nats_distant&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service NATS local comme r\u00e9f\u00e9rence&amp;quot;. Line 27 in scenario &amp;quot;Connexion \u00e0 un service NATS distant&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_service_peppol_mock&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_service_peppol_mock&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_service_peppol_mock&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock&amp;quot;. Line 33 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un service Peppol mock&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_configuration_des_r\u00e9ponses_peppol_mock&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_configuration_des_r\u00e9ponses_peppol_mock&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_configuration_des_r\u00e9ponses_peppol_mock&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock&amp;quot;. Line 38 in scenario &amp;quot;Configuration des r\u00e9ponses Peppol mock&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_recherche_peppol_dune_entreprise_non_enregistr\u00e9e&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_recherche_peppol_dune_entreprise_non_enregistr\u00e9e&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_recherche_peppol_dune_entreprise_non_enregistr\u00e9e&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock&amp;quot;. Line 45 in scenario &amp;quot;Recherche Peppol d&amp;#x27;une entreprise non enregistr\u00e9e&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_service_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_service_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_service_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service PA&amp;quot;. Line 51 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un service PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_1_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_1_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_1_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 1 PA&amp;quot;. Line 61 in scenario &amp;quot;Cr\u00e9ation d&amp;#x27;un monde avec 1 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_2_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_2_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_2_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 68 in scenario &amp;quot;Cr\u00e9ation d&amp;#x27;un monde avec 2 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_4_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_4_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_4_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 4 PA&amp;quot;. Line 74 in scenario &amp;quot;Cr\u00e9ation d&amp;#x27;un monde avec 4 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_les_pa_partagent_le_m\u00eame_service_nats&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_les_pa_partagent_le_m\u00eame_service_nats&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_les_pa_partagent_le_m\u00eame_service_nats&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 82 in scenario &amp;quot;Les PA partagent le m\u00eame service NATS&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_les_pa_ont_des_ports_api_distincts&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_les_pa_ont_des_ports_api_distincts&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_les_pa_ont_des_ports_api_distincts&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 3 PA&amp;quot;. Line 87 in scenario &amp;quot;Les PA ont des ports API distincts&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_toutes_les_pa_r\u00e9pondent_au_healthcheck&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_toutes_les_pa_r\u00e9pondent_au_healthcheck&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_toutes_les_pa_r\u00e9pondent_au_healthcheck&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 95 in scenario &amp;quot;Toutes les PA r\u00e9pondent au healthcheck&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_information_du_monde&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_information_du_monde&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_information_du_monde&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 104 in scenario &amp;quot;Information du monde&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_arr\u00eat_propre_du_monde&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_arr\u00eat_propre_du_monde&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_arr\u00eat_propre_du_monde&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA d\u00e9marr\u00e9&amp;quot;. Line 115 in scenario &amp;quot;Arr\u00eat propre du monde&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_monde_avec_nats_externe&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_monde_avec_nats_externe&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_monde_avec_nats_externe&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service NATS local comme r\u00e9f\u00e9rence&amp;quot;. Line 126 in scenario &amp;quot;Monde avec NATS externe&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_monde_avec_peppol_personnalis\u00e9&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_monde_avec_peppol_personnalis\u00e9&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_monde_avec_peppol_personnalis\u00e9&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock comme r\u00e9f\u00e9rence&amp;quot;. Line 132 in scenario &amp;quot;Monde avec Peppol personnalis\u00e9&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9p\u00f4t_de_facture_entre_2_pa_via_peppol&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9p\u00f4t_de_facture_entre_2_pa_via_peppol&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9p\u00f4t_de_facture_entre_2_pa_via_peppol&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 141 in scenario &amp;quot;D\u00e9p\u00f4t de facture entre 2 PA via Peppol&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_esb_central&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_esb_central&#34;, &#34;duration&#34;: &#34;5 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marragearr\u00eat_service_esb_central&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;5 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\nppppppp port 8953 OK\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_le service &amp;quot;02-esb-central&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_le service &amp;quot;02-esb-central&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service None on port 8953 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready None ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  None started on localhost:8953\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...&#34;}], &#34;test_scenario.py::test_healthcheck_message&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_healthcheck_message&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_healthcheck_message&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function esb_sub at 0x749ae95762a0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_healthcheck_message&amp;gt;&amp;gt;, kwargs = {&amp;#x27;canal&amp;#x27;: &amp;#x27;healthcheck&amp;#x27;, &amp;#x27;world1&amp;#x27;: WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x749...tream.FastStreamServiceContext object at 0x749ae906d7f0&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x749ae9207a10&amp;gt;)])}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nsrc/pac_bdd/esb.py:17: in wrapper\n    return asyncio.run(fn(*args, **kwargs))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/runners.py:195: in run\n    return runner.run(main)\n           ^^^^^^^^^^^^^^^^\n../../../../.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/runners.py:118: in run\n    return self._loop.run_until_complete(task)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/base_events.py:725: in run_until_complete\n    return future.result()\n           ^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nworld1 = WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x749ae900bac0&amp;gt;, pas=[PacServiceContext(...stream.FastStreamServiceContext object at 0x749ae906d7f0&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x749ae9207a10&amp;gt;)]), canal = &amp;#x27;healthcheck&amp;#x27;\n\n    @when(\n        parsers.parse(&amp;quot;j&amp;#x27;\u00e9coute le canal &amp;#x27;{canal}&amp;#x27;&amp;quot;),\n    )\n    @async_to_sync\n    async def esb_sub(\n        world1: WorldContext,\n        canal: str,\n    ):\n        global handle_GLOBAL\n    \n        print(f&amp;quot;esb_sub {canal=}...&amp;quot;)\n        #raise NotImplementedError()\n&amp;gt;       broker = world1.pa.broker\n                 ^^^^^^^^^^^^^^^^\nE       AttributeError: &amp;#x27;PacServiceContext&amp;#x27; object has no attribute &amp;#x27;broker&amp;#x27;\n\nsrc/pac_bdd/esb.py:37: AttributeError\n\n----------------------------- Captured stdout call -----------------------------\nppppppp port 8451 OK\nppppppp port 8926 OK\nppppppp port 8880 OK\n_check_http_health http://localhost:8880/healthcheck\nppppppp port 8384 OK\nppppppp port 8678 OK\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8926 ...\n2026-01-14 23:13:18,688 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 23:13:18,688 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8926 ...\n2026-01-14 23:13:18,696 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-14 23:13:18,696 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8926 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8880\n    server   Documentation at http://0.0.0.0:8880/docs\n \n             Logs:\n \n2026-01-14 23:13:18,916 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 23:13:18,916 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8880/healthcheck\n      INFO   127.0.0.1:60940 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\nesb_sub canal=&amp;#x27;healthcheck&amp;#x27;...\n\n----------------------------- Captured stderr call -----------------------------\n[17156] 2026/01/14 23:13:18.169918 [INF] Starting nats-server\n[17156] 2026/01/14 23:13:18.170006 [INF]   Version:  2.12.3\n[17156] 2026/01/14 23:13:18.170011 [INF]   Git:      [450a519]\n[17156] 2026/01/14 23:13:18.170016 [INF]   Name:     NBFEIZI5TGN3VAMTLLUI3XDVV3OEAMXP3FURJVLM2JZ4ZJJOBMAR225B\n[17156] 2026/01/14 23:13:18.170032 [INF]   ID:       NBFEIZI5TGN3VAMTLLUI3XDVV3OEAMXP3FURJVLM2JZ4ZJJOBMAR225B\n[17156] 2026/01/14 23:13:18.170903 [INF] Listening for client connections on 0.0.0.0:8926\n[17156] 2026/01/14 23:13:18.171418 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 23:13:18,683 INFO     - FastStream app starting...\n2026-01-14 23:13:18,688 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 23:13:18,692 INFO     - FastStream app starting...\n2026-01-14 23:13:18,696 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [17176]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8880 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;\u00e9coute le canal &amp;#x27;healthcheck&amp;#x27;&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;\u00e9coute le canal &amp;#x27;{canal}&amp;#x27;&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8451 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  peppol started on localhost:8451\nINFO     pac0.shared.test.world:world.py:87 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8926 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  esb_central started on localhost:8926\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8880 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8384 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  controle_formats started on localhost:8384\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8678 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  routage started on localhost:8678\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8880 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8880 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x749ae92db460&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 22:13:18 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8880/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:162 Service  api_gateway started on localhost:8880\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [17176]\n2026-01-14 23:13:19,589 INFO     - FastStream app shutting down...\n2026-01-14 23:13:19,590 INFO     - FastStream app shut down gracefully.\n2026-01-14 23:13:19,800 INFO     - FastStream app shutting down...\n2026-01-14 23:13:19,801 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.world:world.py:95 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_canal_pingpong&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_canal_pingpong&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_canal_pingpong&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function esb_sub at 0x749ae95762a0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_canal_pingpong&amp;gt;&amp;gt;, kwargs = {&amp;#x27;canal&amp;#x27;: &amp;#x27;pong&amp;#x27;, &amp;#x27;world1&amp;#x27;: WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x749ae92dac...tream.FastStreamServiceContext object at 0x749ae9207d10&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x749ae9204290&amp;gt;)])}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nsrc/pac_bdd/esb.py:17: in wrapper\n    return asyncio.run(fn(*args, **kwargs))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/runners.py:195: in run\n    return runner.run(main)\n           ^^^^^^^^^^^^^^^^\n../../../../.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/runners.py:118: in run\n    return self._loop.run_until_complete(task)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/base_events.py:725: in run_until_complete\n    return future.result()\n           ^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nworld1 = WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x749ae92dacf0&amp;gt;, pas=[PacServiceContext(...stream.FastStreamServiceContext object at 0x749ae9207d10&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x749ae9204290&amp;gt;)]), canal = &amp;#x27;pong&amp;#x27;\n\n    @when(\n        parsers.parse(&amp;quot;j&amp;#x27;\u00e9coute le canal &amp;#x27;{canal}&amp;#x27;&amp;quot;),\n    )\n    @async_to_sync\n    async def esb_sub(\n        world1: WorldContext,\n        canal: str,\n    ):\n        global handle_GLOBAL\n    \n        print(f&amp;quot;esb_sub {canal=}...&amp;quot;)\n        #raise NotImplementedError()\n&amp;gt;       broker = world1.pa.broker\n                 ^^^^^^^^^^^^^^^^\nE       AttributeError: &amp;#x27;PacServiceContext&amp;#x27; object has no attribute &amp;#x27;broker&amp;#x27;\n\nsrc/pac_bdd/esb.py:37: AttributeError\n\n----------------------------- Captured stdout call -----------------------------\nppppppp port 8752 OK\nppppppp port 8690 OK\nppppppp port 8708 KO [Errno 98] Address already in use\nppppppp port 8982 OK\n_check_http_health http://localhost:8982/healthcheck\nppppppp port 8639 OK\nppppppp port 8398 OK\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8690 ...\n2026-01-14 23:13:20,492 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-14 23:13:20,492 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8690 ...\n2026-01-14 23:13:20,499 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-14 23:13:20,500 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8690 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8982\n    server   Documentation at http://0.0.0.0:8982/docs\n \n             Logs:\n \n2026-01-14 23:13:20,700 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-14 23:13:20,700 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n_check_http_health http://localhost:8982/healthcheck\n      INFO   127.0.0.1:52092 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\nesb_sub canal=&amp;#x27;pong&amp;#x27;...\n\n----------------------------- Captured stderr call -----------------------------\n[17200] 2026/01/14 23:13:19.935032 [INF] Starting nats-server\n[17200] 2026/01/14 23:13:19.935133 [INF]   Version:  2.12.3\n[17200] 2026/01/14 23:13:19.935139 [INF]   Git:      [450a519]\n[17200] 2026/01/14 23:13:19.935143 [INF]   Name:     NANWSOY7FGRJGZF2EAMNTP5IPBCGGHTFZLD7Y7RXVNVBLAGRDKL5JZZQ\n[17200] 2026/01/14 23:13:19.935147 [INF]   ID:       NANWSOY7FGRJGZF2EAMNTP5IPBCGGHTFZLD7Y7RXVNVBLAGRDKL5JZZQ\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[17200] 2026/01/14 23:13:19.935887 [INF] Listening for client connections on 0.0.0.0:8690\n[17200] 2026/01/14 23:13:19.936325 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n2026-01-14 23:13:20,487 INFO     - FastStream app starting...\n2026-01-14 23:13:20,493 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-14 23:13:20,496 INFO     - FastStream app starting...\n2026-01-14 23:13:20,500 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [17216]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8982 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;\u00e9coute le canal &amp;#x27;pong&amp;#x27;&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;\u00e9coute le canal &amp;#x27;{canal}&amp;#x27;&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8752 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  peppol started on localhost:8752\nINFO     pac0.shared.test.world:world.py:87 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8690 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  esb_central started on localhost:8690\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8982 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8639 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  controle_formats started on localhost:8639\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8398 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  routage started on localhost:8398\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8982 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8982 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x749ae92fa750&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Wed, 14 Jan 2026 22:13:20 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8982/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:162 Service  api_gateway started on localhost:8982\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [17216]\n2026-01-14 23:13:21,393 INFO     - FastStream app shutting down...\n2026-01-14 23:13:21,395 INFO     - FastStream app shut down gracefully.\n2026-01-14 23:13:21,601 INFO     - FastStream app shutting down...\n2026-01-14 23:13:21,603 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.world:world.py:95 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;la PA #pa1&amp;quot;. Line 7 in scenario &amp;quot;2 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/pa_multiple.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_r\u00e9solution_sml_r\u00e9ussie_pour_un_participant_enregistr\u00e9&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_r\u00e9solution_sml_r\u00e9ussie_pour_un_participant_enregistr\u00e9&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_r\u00e9solution_sml_r\u00e9ussie_pour_un_participant_enregistr\u00e9&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;R\u00e9solution SML r\u00e9ussie pour un participant enregistr\u00e9&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_r\u00e9solution_sml_\u00e9chou\u00e9e__participant_non_enregistr\u00e9&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_r\u00e9solution_sml_\u00e9chou\u00e9e__participant_non_enregistr\u00e9&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_r\u00e9solution_sml_\u00e9chou\u00e9e__participant_non_enregistr\u00e9&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;R\u00e9solution SML \u00e9chou\u00e9e - participant non enregistr\u00e9&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_r\u00e9cup\u00e9ration_m\u00e9tadonn\u00e9es_smp_r\u00e9ussie&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_r\u00e9cup\u00e9ration_m\u00e9tadonn\u00e9es_smp_r\u00e9ussie&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_r\u00e9cup\u00e9ration_m\u00e9tadonn\u00e9es_smp_r\u00e9ussie&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;R\u00e9cup\u00e9ration m\u00e9tadonn\u00e9es SMP r\u00e9ussie&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_smp_ne_supporte_pas_le_document_type_demand\u00e9&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_smp_ne_supporte_pas_le_document_type_demand\u00e9&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_smp_ne_supporte_pas_le_document_type_demand\u00e9&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;SMP ne supporte pas le document type demand\u00e9&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_lookup_peppol_complet_r\u00e9ussi_par_siren&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_lookup_peppol_complet_r\u00e9ussi_par_siren&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_lookup_peppol_complet_r\u00e9ussi_par_siren&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Lookup PEPPOL complet r\u00e9ussi par SIREN&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_lookup_peppol_complet_r\u00e9ussi_par_siret&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_lookup_peppol_complet_r\u00e9ussi_par_siret&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_lookup_peppol_complet_r\u00e9ussi_par_siret&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Lookup PEPPOL complet r\u00e9ussi par SIRET&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_lookup_peppol_\u00e9chou\u00e9__participant_introuvable&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_lookup_peppol_\u00e9chou\u00e9__participant_introuvable&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_lookup_peppol_\u00e9chou\u00e9__participant_introuvable&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Lookup PEPPOL \u00e9chou\u00e9 - participant introuvable&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_routage_facture_vers_pa_distante_via_peppol&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_routage_facture_vers_pa_distante_via_peppol&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_routage_facture_vers_pa_distante_via_peppol&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Routage facture vers PA distante via PEPPOL&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_routage_facture__destinataire_local_pas_de_lookup_peppol&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_routage_facture__destinataire_local_pas_de_lookup_peppol&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_routage_facture__destinataire_local_pas_de_lookup_peppol&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Routage facture - destinataire local (pas de lookup PEPPOL)&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_routage_facture__fallback_vers_ppf&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_routage_facture__fallback_vers_ppf&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_routage_facture__fallback_vers_ppf&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Routage facture - fallback vers PPF&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_validation_du_certificat_peppol&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_validation_du_certificat_peppol&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_validation_du_certificat_peppol&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Validation du certificat PEPPOL&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_v\u00e9rification_de_la_signature_smp&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_v\u00e9rification_de_la_signature_smp&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_v\u00e9rification_de_la_signature_smp&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;V\u00e9rification de la signature SMP&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_v\u00e9rification_des_document_types_support\u00e9s&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_v\u00e9rification_des_document_types_support\u00e9s&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_v\u00e9rification_des_document_types_support\u00e9s&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;V\u00e9rification des document types support\u00e9s&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_timeout_lors_du_lookup_sml&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_timeout_lors_du_lookup_sml&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_timeout_lors_du_lookup_sml&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Timeout lors du lookup SML&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_smp_temporairement_indisponible&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_smp_temporairement_indisponible&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_smp_temporairement_indisponible&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;SMP temporairement indisponible&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_retry_automatique_apr\u00e8s_\u00e9chec_temporaire&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_retry_automatique_apr\u00e8s_\u00e9chec_temporaire&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_retry_automatique_apr\u00e8s_\u00e9chec_temporaire&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Retry automatique apr\u00e8s \u00e9chec temporaire&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_\u00e9chec_d\u00e9finitif_apr\u00e8s_plusieurs_retries&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_\u00e9chec_d\u00e9finitif_apr\u00e8s_plusieurs_retries&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_\u00e9chec_d\u00e9finitif_apr\u00e8s_plusieurs_retries&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;\u00c9chec d\u00e9finitif apr\u00e8s plusieurs retries&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_communication_bidirectionnelle_entre_2_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_communication_bidirectionnelle_entre_2_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_communication_bidirectionnelle_entre_2_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Communication bidirectionnelle entre 2 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_r\u00e9ception_dune_facture_via_as4_depuis_une_pa_distante&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_r\u00e9ception_dune_facture_via_as4_depuis_une_pa_distante&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_r\u00e9ception_dune_facture_via_as4_depuis_une_pa_distante&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;R\u00e9ception d&amp;#x27;une facture via AS4 depuis une PA distante&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_facture_b2g_via_chorus_pro_peppol&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_facture_b2g_via_chorus_pro_peppol&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_facture_b2g_via_chorus_pro_peppol&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;le service PEPPOL configur\u00e9 en mode &amp;quot;test&amp;quot;&amp;quot;. Line 10 in scenario &amp;quot;Facture B2G via Chorus Pro PEPPOL&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/peppol_old.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_peppol_req&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_peppol_req&#34;, &#34;duration&#34;: &#34;6 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_peppol_req&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;6 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\nppppppp port 9223 OK\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_le service PEPPOL simul\u00e9 avec:&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_le service PEPPOL simul\u00e9 avec:&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 9223 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:191 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:162 Service  peppol started on localhost:9223\nINFO     pac0.shared.test.world:world.py:87 WorldContext: enter context ...\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:174 Stopping service...\nINFO     pac0.shared.test.world:world.py:95 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_md5&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_md5&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_md5&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function check_result at 0x749ae95f85e0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_md5&amp;gt;&amp;gt;, kwargs = {&amp;#x27;peppol_context&amp;#x27;: PeppolContext(sml_zone=&amp;#x27;acc.edelivery.tech.ec.europa.eu&amp;#x27;, enterprise_id=None, siren=None, siret=None, result=&amp;#x27;b881aaeff8eeaed7190491ccdeaa42fc&amp;#x27;), &amp;#x27;result&amp;#x27;: &amp;#x27;6c2675d749449f2c8af1216fd866bb54&amp;#x27;}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\npeppol_context = PeppolContext(sml_zone=&amp;#x27;acc.edelivery.tech.ec.europa.eu&amp;#x27;, enterprise_id=None, siren=None, siret=None, result=&amp;#x27;b881aaeff8eeaed7190491ccdeaa42fc&amp;#x27;), result = &amp;#x27;6c2675d749449f2c8af1216fd866bb54&amp;#x27;\n\n    @then(parsers.parse(&amp;#x27;&amp;#x27;&amp;#x27;j&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27;&amp;#x27;&amp;#x27;))\n    def check_result(\n        peppol_context: PeppolContext,\n        result: str,\n    ):\n        &amp;quot;&amp;quot;&amp;quot;\u00e9tape g\u00e9n\u00e9rique pour tester tout r\u00e9sultat&amp;quot;&amp;quot;&amp;quot;\n        if peppol_context.result != result:\n            print(f&amp;quot;result: {peppol_context.result}&amp;quot;)\n            print(f&amp;quot;expecting: {result}&amp;quot;)\n&amp;gt;       assert peppol_context.result == result\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE       AssertionError\n\nsrc/pac_bdd/peppol.py:129: AssertionError\n\n----------------------------- Captured stdout call -----------------------------\nresult: b881aaeff8eeaed7190491ccdeaa42fc\nexpecting: 6c2675d749449f2c8af1216fd866bb54\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte md5 de &amp;quot;bonjour!&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte md5 de &amp;quot;{msg}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;, &amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;6c2675d749449f2c8af1216fd866bb54&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_identification_france&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_identification_france&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_identification_france&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\nxxxx 0002 0002\nxxxx 0009 0009\nxxxx 9957 9957\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_l\\&amp;#x27;identification par SIRET porte le code &amp;quot;0002&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_l\\&amp;#x27;identification par {facon} porte le code &amp;quot;{code}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_l\\&amp;#x27;identification par SIREN porte le code &amp;quot;0009&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_l\\&amp;#x27;identification par {facon} porte le code &amp;quot;{code}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_l\\&amp;#x27;identification par TVA_FR porte le code &amp;quot;9957&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_l\\&amp;#x27;identification par {facon} porte le code &amp;quot;{code}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_empreinte_participant&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_empreinte_participant&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_empreinte_participant&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte SIREN &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;3ddb2999105b666703fc700e14885016&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte SIRET &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;6dbdf4f29451b37456ca48b550bdbaee&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte TVA_FR &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;d0d6bafc0317e3e8baa9504a9a022f9c&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_h\u00f4te_sml&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_h\u00f4te_sml&#34;, &#34;duration&#34;: &#34;3 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_h\u00f4te_sml&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;3 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_la racine SML &amp;quot;ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_la racine SML &amp;quot;{zone}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIREN &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-3ddb2999105b666703fc700e14885016.iso6523-actorid-upis.ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIRET &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-6dbdf4f29451b37456ca48b550bdbaee.iso6523-actorid-upis.ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour TVA_FR &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-d0d6bafc0317e3e8baa9504a9a022f9c.iso6523-actorid-upis.ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_la racine SML &amp;quot;acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_la racine SML &amp;quot;{zone}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIREN &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-3ddb2999105b666703fc700e14885016.iso6523-actorid-upis.acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIRET &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-6dbdf4f29451b37456ca48b550bdbaee.iso6523-actorid-upis.acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour TVA_FR &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-d0d6bafc0317e3e8baa9504a9a022f9c.iso6523-actorid-upis.acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_rejet_dolibarr&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_rejet_dolibarr&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_rejet_dolibarr&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function compliance_rule_set at 0x749ae95fb1a0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_rejet_dolibarr&amp;gt;&amp;gt;, kwargs = {}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @when(&amp;quot;je d\u00e9finis un contr\u00f4le de conformit\u00e9 m\u00e9tier fournisseur&amp;quot;)\n    def compliance_rule_set():\n&amp;gt;       raise NotImplementedError()\nE       NotImplementedError\n\nsrc/pac_bdd/tobeimplemented.py:45: NotImplementedError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je d\u00e9finis un contr\u00f4le de conformit\u00e9 m\u00e9tier fournisseur&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je d\u00e9finis un contr\u00f4le de conformit\u00e9 m\u00e9tier fournisseur&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_facture_rejet\u00e9e&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_facture_rejet\u00e9e&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_facture_rejet\u00e9e&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function submit_invoice_simple at 0x749ae95fa840&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_facture_rejet\u00e9e&amp;gt;&amp;gt;, kwargs = {}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @when(&amp;quot;je d\u00e9pose une facture&amp;quot;)\n    def submit_invoice_simple():\n        # POST /\n&amp;gt;       raise NotImplementedError()\nE       NotImplementedError\n\nsrc/pac_bdd/tobeimplemented.py:17: NotImplementedError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je d\u00e9pose une facture&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je d\u00e9pose une facture&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}]}, &#34;renderCollapsed&#34;: [&#34;passed&#34;], &#34;initialSort&#34;: &#34;result&#34;, &#34;title&#34;: &#34;report.html&#34;}"></div>
    <script>
      (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
const { getCollapsedCategory, setCollapsedIds } = require('./storage.js')

class DataManager {
    setManager(data) {
        const collapsedCategories = [...getCollapsedCategory(data.renderCollapsed)]
        const collapsedIds = []
        const tests = Object.values(data.tests).flat().map((test, index) => {
            const collapsed = collapsedCategories.includes(test.result.toLowerCase())
            const id = `test_${index}`
            if (collapsed) {
                collapsedIds.push(id)
            }
            return {
                ...test,
                id,
                collapsed,
            }
        })
        const dataBlob = { ...data, tests }
        this.data = { ...dataBlob }
        this.renderData = { ...dataBlob }
        setCollapsedIds(collapsedIds)
    }

    get allData() {
        return { ...this.data }
    }

    resetRender() {
        this.renderData = { ...this.data }
    }

    setRender(data) {
        this.renderData.tests = [...data]
    }

    toggleCollapsedItem(id) {
        this.renderData.tests = this.renderData.tests.map((test) =>
            test.id === id ? { ...test, collapsed: !test.collapsed } : test,
        )
    }

    set allCollapsed(collapsed) {
        this.renderData = { ...this.renderData, tests: [...this.renderData.tests.map((test) => (
            { ...test, collapsed }
        ))] }
    }

    get testSubset() {
        return [...this.renderData.tests]
    }

    get environment() {
        return this.renderData.environment
    }

    get initialSort() {
        return this.data.initialSort
    }
}

module.exports = {
    manager: new DataManager(),
}

},{"./storage.js":8}],2:[function(require,module,exports){
const mediaViewer = require('./mediaviewer.js')
const templateEnvRow = document.getElementById('template_environment_row')
const templateResult = document.getElementById('template_results-table__tbody')

function htmlToElements(html) {
    const temp = document.createElement('template')
    temp.innerHTML = html
    return temp.content.childNodes
}

const find = (selector, elem) => {
    if (!elem) {
        elem = document
    }
    return elem.querySelector(selector)
}

const findAll = (selector, elem) => {
    if (!elem) {
        elem = document
    }
    return [...elem.querySelectorAll(selector)]
}

const dom = {
    getStaticRow: (key, value) => {
        const envRow = templateEnvRow.content.cloneNode(true)
        const isObj = typeof value === 'object' && value !== null
        const values = isObj ? Object.keys(value).map((k) => `${k}: ${value[k]}`) : null

        const valuesElement = htmlToElements(
            values ? `<ul>${values.map((val) => `<li>${val}</li>`).join('')}<ul>` : `<div>${value}</div>`)[0]
        const td = findAll('td', envRow)
        td[0].textContent = key
        td[1].appendChild(valuesElement)

        return envRow
    },
    getResultTBody: ({ testId, id, log, extras, resultsTableRow, tableHtml, result, collapsed }) => {
        const resultBody = templateResult.content.cloneNode(true)
        resultBody.querySelector('tbody').classList.add(result.toLowerCase())
        resultBody.querySelector('tbody').id = testId
        resultBody.querySelector('.collapsible').dataset.id = id

        resultsTableRow.forEach((html) => {
            const t = document.createElement('template')
            t.innerHTML = html
            resultBody.querySelector('.collapsible').appendChild(t.content)
        })

        if (log) {
            // Wrap lines starting with "E" with span.error to color those lines red
            const wrappedLog = log.replace(/^E.*$/gm, (match) => `<span class="error">${match}</span>`)
            resultBody.querySelector('.log').innerHTML = wrappedLog
        } else {
            resultBody.querySelector('.log').remove()
        }

        if (collapsed) {
            resultBody.querySelector('.collapsible > td')?.classList.add('collapsed')
            resultBody.querySelector('.extras-row').classList.add('hidden')
        } else {
            resultBody.querySelector('.collapsible > td')?.classList.remove('collapsed')
        }

        const media = []
        extras?.forEach(({ name, format_type, content }) => {
            if (['image', 'video'].includes(format_type)) {
                media.push({ path: content, name, format_type })
            }

            if (format_type === 'html') {
                resultBody.querySelector('.extraHTML').insertAdjacentHTML('beforeend', `<div>${content}</div>`)
            }
        })
        mediaViewer.setup(resultBody, media)

        // Add custom html from the pytest_html_results_table_html hook
        tableHtml?.forEach((item) => {
            resultBody.querySelector('td[class="extra"]').insertAdjacentHTML('beforeend', item)
        })

        return resultBody
    },
}

module.exports = {
    dom,
    htmlToElements,
    find,
    findAll,
}

},{"./mediaviewer.js":6}],3:[function(require,module,exports){
const { manager } = require('./datamanager.js')
const { doSort } = require('./sort.js')
const storageModule = require('./storage.js')

const getFilteredSubSet = (filter) =>
    manager.allData.tests.filter(({ result }) => filter.includes(result.toLowerCase()))

const doInitFilter = () => {
    const currentFilter = storageModule.getVisible()
    const filteredSubset = getFilteredSubSet(currentFilter)
    manager.setRender(filteredSubset)
}

const doFilter = (type, show) => {
    if (show) {
        storageModule.showCategory(type)
    } else {
        storageModule.hideCategory(type)
    }

    const currentFilter = storageModule.getVisible()
    const filteredSubset = getFilteredSubSet(currentFilter)
    manager.setRender(filteredSubset)

    const sortColumn = storageModule.getSort()
    doSort(sortColumn, true)
}

module.exports = {
    doFilter,
    doInitFilter,
}

},{"./datamanager.js":1,"./sort.js":7,"./storage.js":8}],4:[function(require,module,exports){
const { redraw, bindEvents, renderStatic } = require('./main.js')
const { doInitFilter } = require('./filter.js')
const { doInitSort } = require('./sort.js')
const { manager } = require('./datamanager.js')
const data = JSON.parse(document.getElementById('data-container').dataset.jsonblob)

function init() {
    manager.setManager(data)
    doInitFilter()
    doInitSort()
    renderStatic()
    redraw()
    bindEvents()
}

init()

},{"./datamanager.js":1,"./filter.js":3,"./main.js":5,"./sort.js":7}],5:[function(require,module,exports){
const { dom, find, findAll } = require('./dom.js')
const { manager } = require('./datamanager.js')
const { doSort } = require('./sort.js')
const { doFilter } = require('./filter.js')
const {
    getVisible,
    getCollapsedIds,
    setCollapsedIds,
    getSort,
    getSortDirection,
    possibleFilters,
} = require('./storage.js')

const removeChildren = (node) => {
    while (node.firstChild) {
        node.removeChild(node.firstChild)
    }
}

const renderStatic = () => {
    const renderEnvironmentTable = () => {
        const environment = manager.environment
        const rows = Object.keys(environment).map((key) => dom.getStaticRow(key, environment[key]))
        const table = document.getElementById('environment')
        removeChildren(table)
        rows.forEach((row) => table.appendChild(row))
    }
    renderEnvironmentTable()
}

const addItemToggleListener = (elem) => {
    elem.addEventListener('click', ({ target }) => {
        const id = target.parentElement.dataset.id
        manager.toggleCollapsedItem(id)

        const collapsedIds = getCollapsedIds()
        if (collapsedIds.includes(id)) {
            const updated = collapsedIds.filter((item) => item !== id)
            setCollapsedIds(updated)
        } else {
            collapsedIds.push(id)
            setCollapsedIds(collapsedIds)
        }
        redraw()
    })
}

const renderContent = (tests) => {
    const sortAttr = getSort(manager.initialSort)
    const sortAsc = JSON.parse(getSortDirection())
    const rows = tests.map(dom.getResultTBody)
    const table = document.getElementById('results-table')
    const tableHeader = document.getElementById('results-table-head')

    const newTable = document.createElement('table')
    newTable.id = 'results-table'

    // remove all sorting classes and set the relevant
    findAll('.sortable', tableHeader).forEach((elem) => elem.classList.remove('asc', 'desc'))
    tableHeader.querySelector(`.sortable[data-column-type="${sortAttr}"]`)?.classList.add(sortAsc ? 'desc' : 'asc')
    newTable.appendChild(tableHeader)

    if (!rows.length) {
        const emptyTable = document.getElementById('template_results-table__body--empty').content.cloneNode(true)
        newTable.appendChild(emptyTable)
    } else {
        rows.forEach((row) => {
            if (!!row) {
                findAll('.collapsible td:not(.col-links', row).forEach(addItemToggleListener)
                find('.logexpander', row).addEventListener('click',
                    (evt) => evt.target.parentNode.classList.toggle('expanded'),
                )
                newTable.appendChild(row)
            }
        })
    }

    table.replaceWith(newTable)
}

const renderDerived = () => {
    const currentFilter = getVisible()
    possibleFilters.forEach((result) => {
        const input = document.querySelector(`input[data-test-result="${result}"]`)
        input.checked = currentFilter.includes(result)
    })
}

const bindEvents = () => {
    const filterColumn = (evt) => {
        const { target: element } = evt
        const { testResult } = element.dataset

        doFilter(testResult, element.checked)
        const collapsedIds = getCollapsedIds()
        const updated = manager.renderData.tests.map((test) => {
            return {
                ...test,
                collapsed: collapsedIds.includes(test.id),
            }
        })
        manager.setRender(updated)
        redraw()
    }

    const header = document.getElementById('environment-header')
    header.addEventListener('click', () => {
        const table = document.getElementById('environment')
        table.classList.toggle('hidden')
        header.classList.toggle('collapsed')
    })

    findAll('input[name="filter_checkbox"]').forEach((elem) => {
        elem.addEventListener('click', filterColumn)
    })

    findAll('.sortable').forEach((elem) => {
        elem.addEventListener('click', (evt) => {
            const { target: element } = evt
            const { columnType } = element.dataset
            doSort(columnType)
            redraw()
        })
    })

    document.getElementById('show_all_details').addEventListener('click', () => {
        manager.allCollapsed = false
        setCollapsedIds([])
        redraw()
    })
    document.getElementById('hide_all_details').addEventListener('click', () => {
        manager.allCollapsed = true
        const allIds = manager.renderData.tests.map((test) => test.id)
        setCollapsedIds(allIds)
        redraw()
    })
}

const redraw = () => {
    const { testSubset } = manager

    renderContent(testSubset)
    renderDerived()
}

module.exports = {
    redraw,
    bindEvents,
    renderStatic,
}

},{"./datamanager.js":1,"./dom.js":2,"./filter.js":3,"./sort.js":7,"./storage.js":8}],6:[function(require,module,exports){
class MediaViewer {
    constructor(assets) {
        this.assets = assets
        this.index = 0
    }

    nextActive() {
        this.index = this.index === this.assets.length - 1 ? 0 : this.index + 1
        return [this.activeFile, this.index]
    }

    prevActive() {
        this.index = this.index === 0 ? this.assets.length - 1 : this.index -1
        return [this.activeFile, this.index]
    }

    get currentIndex() {
        return this.index
    }

    get activeFile() {
        return this.assets[this.index]
    }
}


const setup = (resultBody, assets) => {
    if (!assets.length) {
        resultBody.querySelector('.media').classList.add('hidden')
        return
    }

    const mediaViewer = new MediaViewer(assets)
    const container = resultBody.querySelector('.media-container')
    const leftArrow = resultBody.querySelector('.media-container__nav--left')
    const rightArrow = resultBody.querySelector('.media-container__nav--right')
    const mediaName = resultBody.querySelector('.media__name')
    const counter = resultBody.querySelector('.media__counter')
    const imageEl = resultBody.querySelector('img')
    const sourceEl = resultBody.querySelector('source')
    const videoEl = resultBody.querySelector('video')

    const setImg = (media, index) => {
        if (media?.format_type === 'image') {
            imageEl.src = media.path

            imageEl.classList.remove('hidden')
            videoEl.classList.add('hidden')
        } else if (media?.format_type === 'video') {
            sourceEl.src = media.path

            videoEl.classList.remove('hidden')
            imageEl.classList.add('hidden')
        }

        mediaName.innerText = media?.name
        counter.innerText = `${index + 1} / ${assets.length}`
    }
    setImg(mediaViewer.activeFile, mediaViewer.currentIndex)

    const moveLeft = () => {
        const [media, index] = mediaViewer.prevActive()
        setImg(media, index)
    }
    const doRight = () => {
        const [media, index] = mediaViewer.nextActive()
        setImg(media, index)
    }
    const openImg = () => {
        window.open(mediaViewer.activeFile.path, '_blank')
    }
    if (assets.length === 1) {
        container.classList.add('media-container--fullscreen')
    } else {
        leftArrow.addEventListener('click', moveLeft)
        rightArrow.addEventListener('click', doRight)
    }
    imageEl.addEventListener('click', openImg)
}

module.exports = {
    setup,
}

},{}],7:[function(require,module,exports){
const { manager } = require('./datamanager.js')
const storageModule = require('./storage.js')

const genericSort = (list, key, ascending, customOrder) => {
    let sorted
    if (customOrder) {
        sorted = list.sort((a, b) => {
            const aValue = a.result.toLowerCase()
            const bValue = b.result.toLowerCase()

            const aIndex = customOrder.findIndex((item) => item.toLowerCase() === aValue)
            const bIndex = customOrder.findIndex((item) => item.toLowerCase() === bValue)

            // Compare the indices to determine the sort order
            return aIndex - bIndex
        })
    } else {
        sorted = list.sort((a, b) => a[key] === b[key] ? 0 : a[key] > b[key] ? 1 : -1)
    }

    if (ascending) {
        sorted.reverse()
    }
    return sorted
}

const durationSort = (list, ascending) => {
    const parseDuration = (duration) => {
        if (duration.includes(':')) {
            // If it's in the format "HH:mm:ss"
            const [hours, minutes, seconds] = duration.split(':').map(Number)
            return (hours * 3600 + minutes * 60 + seconds) * 1000
        } else {
            // If it's in the format "nnn ms"
            return parseInt(duration)
        }
    }
    const sorted = list.sort((a, b) => parseDuration(a['duration']) - parseDuration(b['duration']))
    if (ascending) {
        sorted.reverse()
    }
    return sorted
}

const doInitSort = () => {
    const type = storageModule.getSort(manager.initialSort)
    const ascending = storageModule.getSortDirection()
    const list = manager.testSubset
    const initialOrder = ['Error', 'Failed', 'Rerun', 'XFailed', 'XPassed', 'Skipped', 'Passed']

    storageModule.setSort(type)
    storageModule.setSortDirection(ascending)

    if (type?.toLowerCase() === 'original') {
        manager.setRender(list)
    } else {
        let sortedList
        switch (type) {
        case 'duration':
            sortedList = durationSort(list, ascending)
            break
        case 'result':
            sortedList = genericSort(list, type, ascending, initialOrder)
            break
        default:
            sortedList = genericSort(list, type, ascending)
            break
        }
        manager.setRender(sortedList)
    }
}

const doSort = (type, skipDirection) => {
    const newSortType = storageModule.getSort(manager.initialSort) !== type
    const currentAsc = storageModule.getSortDirection()
    let ascending
    if (skipDirection) {
        ascending = currentAsc
    } else {
        ascending = newSortType ? false : !currentAsc
    }
    storageModule.setSort(type)
    storageModule.setSortDirection(ascending)

    const list = manager.testSubset
    const sortedList = type === 'duration' ? durationSort(list, ascending) : genericSort(list, type, ascending)
    manager.setRender(sortedList)
}

module.exports = {
    doInitSort,
    doSort,
}

},{"./datamanager.js":1,"./storage.js":8}],8:[function(require,module,exports){
const possibleFilters = [
    'passed',
    'skipped',
    'failed',
    'error',
    'xfailed',
    'xpassed',
    'rerun',
]

const getVisible = () => {
    const url = new URL(window.location.href)
    const settings = new URLSearchParams(url.search).get('visible')
    const lower = (item) => {
        const lowerItem = item.toLowerCase()
        if (possibleFilters.includes(lowerItem)) {
            return lowerItem
        }
        return null
    }
    return settings === null ?
        possibleFilters :
        [...new Set(settings?.split(',').map(lower).filter((item) => item))]
}

const hideCategory = (categoryToHide) => {
    const url = new URL(window.location.href)
    const visibleParams = new URLSearchParams(url.search).get('visible')
    const currentVisible = visibleParams ? visibleParams.split(',') : [...possibleFilters]
    const settings = [...new Set(currentVisible)].filter((f) => f !== categoryToHide).join(',')

    url.searchParams.set('visible', settings)
    window.history.pushState({}, null, unescape(url.href))
}

const showCategory = (categoryToShow) => {
    if (typeof window === 'undefined') {
        return
    }
    const url = new URL(window.location.href)
    const currentVisible = new URLSearchParams(url.search).get('visible')?.split(',').filter(Boolean) ||
        [...possibleFilters]
    const settings = [...new Set([categoryToShow, ...currentVisible])]
    const noFilter = possibleFilters.length === settings.length || !settings.length

    noFilter ? url.searchParams.delete('visible') : url.searchParams.set('visible', settings.join(','))
    window.history.pushState({}, null, unescape(url.href))
}

const getSort = (initialSort) => {
    const url = new URL(window.location.href)
    let sort = new URLSearchParams(url.search).get('sort')
    if (!sort) {
        sort = initialSort || 'result'
    }
    return sort
}

const setSort = (type) => {
    const url = new URL(window.location.href)
    url.searchParams.set('sort', type)
    window.history.pushState({}, null, unescape(url.href))
}

const getCollapsedCategory = (renderCollapsed) => {
    let categories
    if (typeof window !== 'undefined') {
        const url = new URL(window.location.href)
        const collapsedItems = new URLSearchParams(url.search).get('collapsed')
        switch (true) {
        case !renderCollapsed && collapsedItems === null:
            categories = ['passed']
            break
        case collapsedItems?.length === 0 || /^["']{2}$/.test(collapsedItems):
            categories = []
            break
        case /^all$/.test(collapsedItems) || collapsedItems === null && /^all$/.test(renderCollapsed):
            categories = [...possibleFilters]
            break
        default:
            categories = collapsedItems?.split(',').map((item) => item.toLowerCase()) || renderCollapsed
            break
        }
    } else {
        categories = []
    }
    return categories
}

const getSortDirection = () => JSON.parse(sessionStorage.getItem('sortAsc')) || false
const setSortDirection = (ascending) => sessionStorage.setItem('sortAsc', ascending)

const getCollapsedIds = () => JSON.parse(sessionStorage.getItem('collapsedIds')) || []
const setCollapsedIds = (list) => sessionStorage.setItem('collapsedIds', JSON.stringify(list))

module.exports = {
    getVisible,
    hideCategory,
    showCategory,
    getCollapsedIds,
    setCollapsedIds,
    getSort,
    setSort,
    getSortDirection,
    setSortDirection,
    getCollapsedCategory,
    possibleFilters,
}

},{}]},{},[4]);
    </script>
  </footer>
</html>