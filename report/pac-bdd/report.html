<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title id="head-title">report.html</title>
      <style type="text/css">body {
  font-family: Helvetica, Arial, sans-serif;
  font-size: 12px;
  /* do not increase min-width as some may use split screens */
  min-width: 800px;
  color: #999;
}

h1 {
  font-size: 24px;
  color: black;
}

h2 {
  font-size: 16px;
  color: black;
}

p {
  color: black;
}

a {
  color: #999;
}

table {
  border-collapse: collapse;
}

/******************************
 * SUMMARY INFORMATION
 ******************************/
#environment td {
  padding: 5px;
  border: 1px solid #e6e6e6;
  vertical-align: top;
}
#environment tr:nth-child(odd) {
  background-color: #f6f6f6;
}
#environment ul {
  margin: 0;
  padding: 0 20px;
}

/******************************
 * TEST RESULT COLORS
 ******************************/
span.passed,
.passed .col-result {
  color: green;
}

span.skipped,
span.xfailed,
span.rerun,
.skipped .col-result,
.xfailed .col-result,
.rerun .col-result {
  color: orange;
}

span.error,
span.failed,
span.xpassed,
.error .col-result,
.failed .col-result,
.xpassed .col-result {
  color: red;
}

.col-links__extra {
  margin-right: 3px;
}

/******************************
 * RESULTS TABLE
 *
 * 1. Table Layout
 * 2. Extra
 * 3. Sorting items
 *
 ******************************/
/*------------------
 * 1. Table Layout
 *------------------*/
#results-table {
  border: 1px solid #e6e6e6;
  color: #999;
  font-size: 12px;
  width: 100%;
}
#results-table th,
#results-table td {
  padding: 5px;
  border: 1px solid #e6e6e6;
  text-align: left;
}
#results-table th {
  font-weight: bold;
}

/*------------------
 * 2. Extra
 *------------------*/
.logwrapper {
  max-height: 230px;
  overflow-y: scroll;
  background-color: #e6e6e6;
}
.logwrapper.expanded {
  max-height: none;
}
.logwrapper.expanded .logexpander:after {
  content: "collapse [-]";
}
.logwrapper .logexpander {
  z-index: 1;
  position: sticky;
  top: 10px;
  width: max-content;
  border: 1px solid;
  border-radius: 3px;
  padding: 5px 7px;
  margin: 10px 0 10px calc(100% - 80px);
  cursor: pointer;
  background-color: #e6e6e6;
}
.logwrapper .logexpander:after {
  content: "expand [+]";
}
.logwrapper .logexpander:hover {
  color: #000;
  border-color: #000;
}
.logwrapper .log {
  min-height: 40px;
  position: relative;
  top: -50px;
  height: calc(100% + 50px);
  border: 1px solid #e6e6e6;
  color: black;
  display: block;
  font-family: "Courier New", Courier, monospace;
  padding: 5px;
  padding-right: 80px;
  white-space: pre-wrap;
}

div.media {
  border: 1px solid #e6e6e6;
  float: right;
  height: 240px;
  margin: 0 5px;
  overflow: hidden;
  width: 320px;
}

.media-container {
  display: grid;
  grid-template-columns: 25px auto 25px;
  align-items: center;
  flex: 1 1;
  overflow: hidden;
  height: 200px;
}

.media-container--fullscreen {
  grid-template-columns: 0px auto 0px;
}

.media-container__nav--right,
.media-container__nav--left {
  text-align: center;
  cursor: pointer;
}

.media-container__viewport {
  cursor: pointer;
  text-align: center;
  height: inherit;
}
.media-container__viewport img,
.media-container__viewport video {
  object-fit: cover;
  width: 100%;
  max-height: 100%;
}

.media__name,
.media__counter {
  display: flex;
  flex-direction: row;
  justify-content: space-around;
  flex: 0 0 25px;
  align-items: center;
}

.collapsible td:not(.col-links) {
  cursor: pointer;
}
.collapsible td:not(.col-links):hover::after {
  color: #bbb;
  font-style: italic;
  cursor: pointer;
}

.col-result {
  width: 130px;
}
.col-result:hover::after {
  content: " (hide details)";
}

.col-result.collapsed:hover::after {
  content: " (show details)";
}

#environment-header h2:hover::after {
  content: " (hide details)";
  color: #bbb;
  font-style: italic;
  cursor: pointer;
  font-size: 12px;
}

#environment-header.collapsed h2:hover::after {
  content: " (show details)";
  color: #bbb;
  font-style: italic;
  cursor: pointer;
  font-size: 12px;
}

/*------------------
 * 3. Sorting items
 *------------------*/
.sortable {
  cursor: pointer;
}
.sortable.desc:after {
  content: " ";
  position: relative;
  left: 5px;
  bottom: -12.5px;
  border: 10px solid #4caf50;
  border-bottom: 0;
  border-left-color: transparent;
  border-right-color: transparent;
}
.sortable.asc:after {
  content: " ";
  position: relative;
  left: 5px;
  bottom: 12.5px;
  border: 10px solid #4caf50;
  border-top: 0;
  border-left-color: transparent;
  border-right-color: transparent;
}

.hidden, .summary__reload__button.hidden {
  display: none;
}

.summary__data {
  flex: 0 0 550px;
}
.summary__reload {
  flex: 1 1;
  display: flex;
  justify-content: center;
}
.summary__reload__button {
  flex: 0 0 300px;
  display: flex;
  color: white;
  font-weight: bold;
  background-color: #4caf50;
  text-align: center;
  justify-content: center;
  align-items: center;
  border-radius: 3px;
  cursor: pointer;
}
.summary__reload__button:hover {
  background-color: #46a049;
}
.summary__spacer {
  flex: 0 0 550px;
}

.controls {
  display: flex;
  justify-content: space-between;
}

.filters,
.collapse {
  display: flex;
  align-items: center;
}
.filters button,
.collapse button {
  color: #999;
  border: none;
  background: none;
  cursor: pointer;
  text-decoration: underline;
}
.filters button:hover,
.collapse button:hover {
  color: #ccc;
}

.filter__label {
  margin-right: 10px;
}

      </style>
    
  </head>
  <body>
    <h1 id="title">report.html</h1>
    <p>Report generated on 15-Jan-2026 at 10:27:04 by <a href="https://pypi.python.org/pypi/pytest-html">pytest-html</a>
        v4.1.1</p>
    <div id="environment-header">
      <h2>Environment</h2>
    </div>
    <table id="environment"></table>
    <!-- TEMPLATES -->
      <template id="template_environment_row">
      <tr>
        <td></td>
        <td></td>
      </tr>
    </template>
    <template id="template_results-table__body--empty">
      <tbody class="results-table-row">
        <tr id="not-found-message">
          <td colspan="4">No results found. Check the filters.</th>
        </tr>
    </template>
    <template id="template_results-table__tbody">
      <tbody class="results-table-row">
        <tr class="collapsible">
        </tr>
        <tr class="extras-row">
          <td class="extra" colspan="4">
            <div class="extraHTML"></div>
            <div class="media">
              <div class="media-container">
                  <div class="media-container__nav--left"><</div>
                  <div class="media-container__viewport">
                    <img src="" />
                    <video controls>
                      <source src="" type="video/mp4">
                    </video>
                  </div>
                  <div class="media-container__nav--right">></div>
                </div>
                <div class="media__name"></div>
                <div class="media__counter"></div>
            </div>
            <div class="logwrapper">
              <div class="logexpander"></div>
              <div class="log"></div>
            </div>
          </td>
        </tr>
      </tbody>
    </template>
    <!-- END TEMPLATES -->
    <div class="summary">
      <div class="summary__data">
        <h2>Summary</h2>
        <div class="additional-summary prefix">
        </div>
        <p class="run-count">48 tests took 00:00:26.</p>
        <p class="filter">(Un)check the boxes to filter the results.</p>
        <div class="summary__reload">
          <div class="summary__reload__button hidden" onclick="location.reload()">
            <div>There are still tests running. <br />Reload this page to get the latest results!</div>
          </div>
        </div>
        <div class="summary__spacer"></div>
        <div class="controls">
          <div class="filters">
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="failed" />
            <span class="failed">37 Failed,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="passed" />
            <span class="passed">11 Passed,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="skipped" disabled/>
            <span class="skipped">0 Skipped,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="xfailed" disabled/>
            <span class="xfailed">0 Expected failures,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="xpassed" disabled/>
            <span class="xpassed">0 Unexpected passes,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="error" disabled/>
            <span class="error">0 Errors,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="rerun" disabled/>
            <span class="rerun">0 Reruns</span>
          </div>
          <div class="collapse">
            <button id="show_all_details">Show all details</button>&nbsp;/&nbsp;<button id="hide_all_details">Hide all details</button>
          </div>
        </div>
      </div>
      <div class="additional-summary summary">
      </div>
      <div class="additional-summary postfix">
      </div>
    </div>
    <table id="results-table">
      <thead id="results-table-head">
        <tr>
          <th class="sortable" data-column-type="result">Result</th>
          <th class="sortable" data-column-type="testId">Test</th>
          <th class="sortable" data-column-type="duration">Duration</th>
          <th>Links</th>
        </tr>
      </thead>
    </table>
  </body>
  <footer>
    <div id="data-container" data-jsonblob="{&#34;environment&#34;: {&#34;Python&#34;: &#34;3.13.2&#34;, &#34;Platform&#34;: &#34;Linux-6.8.0-90-generic-x86_64-with-glibc2.39&#34;, &#34;Packages&#34;: {&#34;pytest&#34;: &#34;8.4.2&#34;, &#34;pluggy&#34;: &#34;1.6.0&#34;}, &#34;Plugins&#34;: {&#34;html&#34;: &#34;4.1.1&#34;, &#34;bdd&#34;: &#34;8.1.0&#34;, &#34;metadata&#34;: &#34;3.1.1&#34;, &#34;asyncio&#34;: &#34;1.3.0&#34;, &#34;md-report&#34;: &#34;0.7.0&#34;, &#34;anyio&#34;: &#34;4.12.0&#34;}}, &#34;tests&#34;: {&#34;test_fixture.py::test_dummy_fixture&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_fixture.py::test_dummy_fixture&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_fixture.py::test_dummy_fixture&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;No log output captured.&#34;}], &#34;test_fixture.py::test_dummy_async_fixture&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_fixture.py::test_dummy_async_fixture&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_fixture.py::test_dummy_async_fixture&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log setup ------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n&#34;}], &#34;test_openapi.py::test_swagger_flow_service&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_openapi.py::test_swagger_flow_service&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_openapi.py::test_swagger_flow_service&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;def test_swagger_flow_service():\n        url = &amp;#x27;???&amp;#x27;\n&amp;gt;       _test_swagger(\n            url,\n            &amp;quot;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE A - PR XP Z12-013 - AFNOR-Flow_Service-1.1.0-swagger.json&amp;quot;,\n        )\n\ntest_openapi.py:24: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nurl = &amp;#x27;???&amp;#x27;, swagger = &amp;#x27;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE A - PR XP Z12-013 - AFNOR-Flow_Service-1.1.0-swagger.json&amp;#x27;\n\n    def _test_swagger(url: str, swagger: str):\n        &amp;quot;&amp;quot;&amp;quot;\n            V\u00e9rifier si une API respecte une definition Swagger/OpenAPI\n    \n        Cette API doit respecter le versioning indiqu\u00e9 dans l\u2019URL de la route API du Swagger. Dans un objectif de\n        simplification le versioning des routes n\u2019est pas affich\u00e9 dans le pr\u00e9sent document;\n        Dans cette API publi\u00e9e par le Fournisseur API ce dernier peut :\n        \u2022Avoir une URL sp\u00e9cifique en amont du versioning\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les requ\u00eates.\n        \u2022Ajouter des param\u00e8tres aux routes dans les requ\u00eates.\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les r\u00e9ponses.\n        \u2022Ajouter des codes erreurs dans les r\u00e9ponses.\n        &amp;quot;&amp;quot;&amp;quot;\n&amp;gt;       raise NotImplementedError(&amp;quot;swagger compliance non test\u00e9&amp;quot;)\nE       NotImplementedError: swagger compliance non test\u00e9\n\ntest_openapi.py:18: NotImplementedError\n&#34;}], &#34;test_openapi.py::test_swagger_directory_service&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_openapi.py::test_swagger_directory_service&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_openapi.py::test_swagger_directory_service&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;def test_swagger_directory_service():\n        url = &amp;quot;???&amp;quot;\n&amp;gt;       _test_swagger(\n            url,\n            &amp;quot;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE B - PR XP Z12-013 - AFNOR-Directory_Service-1.1.0-swagger.json&amp;quot;,\n        )\n\ntest_openapi.py:32: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nurl = &amp;#x27;???&amp;#x27;, swagger = &amp;#x27;docs/norme/XP_Z12-013_SWAGGER_Annexes_A_et_B_V1.2/ANNEXE B - PR XP Z12-013 - AFNOR-Directory_Service-1.1.0-swagger.json&amp;#x27;\n\n    def _test_swagger(url: str, swagger: str):\n        &amp;quot;&amp;quot;&amp;quot;\n            V\u00e9rifier si une API respecte une definition Swagger/OpenAPI\n    \n        Cette API doit respecter le versioning indiqu\u00e9 dans l\u2019URL de la route API du Swagger. Dans un objectif de\n        simplification le versioning des routes n\u2019est pas affich\u00e9 dans le pr\u00e9sent document;\n        Dans cette API publi\u00e9e par le Fournisseur API ce dernier peut :\n        \u2022Avoir une URL sp\u00e9cifique en amont du versioning\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les requ\u00eates.\n        \u2022Ajouter des param\u00e8tres aux routes dans les requ\u00eates.\n        \u2022Ajouter des propri\u00e9t\u00e9s aux objets dans les r\u00e9ponses.\n        \u2022Ajouter des codes erreurs dans les r\u00e9ponses.\n        &amp;quot;&amp;quot;&amp;quot;\n&amp;gt;       raise NotImplementedError(&amp;quot;swagger compliance non test\u00e9&amp;quot;)\nE       NotImplementedError: swagger compliance non test\u00e9\n\ntest_openapi.py:18: NotImplementedError\n&#34;}], &#34;test_pac0.py::test_pac0_import_services&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_pac0.py::test_pac0_import_services&#34;, &#34;duration&#34;: &#34;226 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_pac0.py::test_pac0_import_services&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;226 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;+ Exception Group Traceback (most recent call last):\n  |   File &amp;quot;/home/philippe/src/PA_Communautaire/packages/pac-bdd/test_pac0.py&amp;quot;, line 21, in test_pac0_import_services\n  |     async with asyncio.TaskGroup() as tg:\n  |                ~~~~~~~~~~~~~~~~~^^\n  |   File &amp;quot;/home/philippe/.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/taskgroups.py&amp;quot;, line 71, in __aexit__\n  |     return await self._aexit(et, exc)\n  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  |   File &amp;quot;/home/philippe/.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/lib/python3.13/asyncio/taskgroups.py&amp;quot;, line 173, in _aexit\n  |     raise BaseExceptionGroup(\n  |     ...&amp;lt;2 lines&amp;gt;...\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File &amp;quot;/home/philippe/src/PA_Communautaire/packages/pac-bdd/test_pac0.py&amp;quot;, line 22, in test_pac0_import_services\n    |     task1 = tg.create_task(api_gateway_main.app.run())\n    |                            ^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: &amp;#x27;FastAPI&amp;#x27; object has no attribute &amp;#x27;run&amp;#x27;\n    +------------------------------------\n\n------------------------------ Captured log setup ------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n\n----------------------------- Captured stdout call -----------------------------\nConnecting to NATS nats://localhost:4222 ...\nConnecting to NATS nats://localhost:4222 ...\nConnecting to NATS nats://localhost:4222 ...\n&#34;}], &#34;test_scenario.py::test_simpliste_avec_commentaire&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_simpliste_avec_commentaire&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_simpliste_avec_commentaire&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais quelque chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais quelque chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;ai fait 4 choses&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;ai fait {nb} choses&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_simpliste&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_simpliste&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_simpliste&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function _ at 0x73499c69c2c0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_simpliste&amp;gt;&amp;gt;, kwargs = {&amp;#x27;nb&amp;#x27;: &amp;#x27;4&amp;#x27;}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nnb = &amp;#x27;4&amp;#x27;\n\n    @then(parsers.parse(&amp;quot;&amp;quot;&amp;quot;j&amp;#x27;ai fait {nb} choses&amp;quot;&amp;quot;&amp;quot;))\n    def _(nb):\n        # si le nombre donn\u00e9e `nb` ne corresponds pas au contexte, on \u00e9choue\n&amp;gt;       assert ctx[&amp;#x27;nb&amp;#x27;] == int(nb)\n               ^^^^^^^^^^^^^^^^^^^^\nE       AssertionError\n\nsrc/pac_bdd/demo.py:31: AssertionError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais quelque chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais quelque chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je fais autre chose&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je fais autre chose&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;ai fait 4 choses&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;ai fait {nb} choses&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_trackingid_fourni&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_trackingid_fourni&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_trackingid_fourni&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 13 in scenario &amp;quot;trackingId fourni&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/trackingId.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:9094/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8808 ...\n2026-01-15 10:26:39,365 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:26:39,366 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8808 ...\n2026-01-15 10:26:39,374 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:26:39,374 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8808 ...\n2026-01-15 10:26:39,392 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:26:39,393 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8808 ...\n2026-01-15 10:26:39,394 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:26:39,395 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8808 ...\n2026-01-15 10:26:39,407 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-15 10:26:39,407 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8808 ...\n2026-01-15 10:26:39,415 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:26:39,416 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:26:39,416 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:39,416 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:39,416 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:39,417 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:39,417 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:26:39,417 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:39,418 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:39,418 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:26:39,418 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:26:39,418 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:39,419 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:39,419 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:26:39,419 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8808 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:9094\n    server   Documentation at http://0.0.0.0:9094/docs\n \n             Logs:\n \n2026-01-15 10:26:39,529 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:26:39,530 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:26:39,531 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:26:39,532 INFO     - *                | 7cd34cd7-8 - Received\n2026-01-15 10:26:39,535 INFO     - *                | 7cd34cd7-8 - Processed\n_check_http_health http://localhost:9094/healthcheck\n      INFO   127.0.0.1:44002 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:44004 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[35377] 2026/01/15 10:26:38.959157 [INF] Starting nats-server\n[35377] 2026/01/15 10:26:38.959217 [INF]   Version:  2.12.3\n[35377] 2026/01/15 10:26:38.959220 [INF]   Git:      [450a519]\n[35377] 2026/01/15 10:26:38.959222 [INF]   Name:     NDW4ANKAKR2Q5EJGJUFSJBIS33ZD2DACOZMYWFDRV5UFTFWIYCXXAMD5\n[35377] 2026/01/15 10:26:38.959228 [INF]   ID:       NDW4ANKAKR2Q5EJGJUFSJBIS33ZD2DACOZMYWFDRV5UFTFWIYCXXAMD5\n[35377] 2026/01/15 10:26:38.959577 [INF] Listening for client connections on 0.0.0.0:8808\n[35377] 2026/01/15 10:26:38.959832 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:26:39,361 INFO     - FastStream app starting...\n2026-01-15 10:26:39,366 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:39,370 INFO     - FastStream app starting...\n2026-01-15 10:26:39,374 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:39,389 INFO     - FastStream app starting...\n2026-01-15 10:26:39,392 INFO     - FastStream app starting...\n2026-01-15 10:26:39,393 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:39,395 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:39,404 INFO     - FastStream app starting...\n2026-01-15 10:26:39,408 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:39,412 INFO     - FastStream app starting...\n2026-01-15 10:26:39,419 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [35393]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:9094 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8581 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:8581\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8808 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:8808\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 9094 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 9089 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:9089\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 9212 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:9212\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 8819 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:8819\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 9121 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:9121\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8591 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:8591\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 9115 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:9115\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 8569 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:8569\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9094 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9094 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x73499ba92270&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:39 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:9094/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:9094\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9094 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x73499ba93b60&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:39 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:9094/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [35393]\n2026-01-15 10:26:40,363 INFO     - FastStream app shutting down...\n2026-01-15 10:26:40,364 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:40,473 INFO     - FastStream app shutting down...\n2026-01-15 10:26:40,474 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:40,692 INFO     - FastStream app shutting down...\n2026-01-15 10:26:40,693 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:40,807 INFO     - FastStream app shutting down...\n2026-01-15 10:26:40,808 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:40,896 INFO     - FastStream app shutting down...\n2026-01-15 10:26:40,897 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:41,016 INFO     - FastStream app shutting down...\n2026-01-15 10:26:41,017 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_trackingid_absent&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_trackingid_absent&#34;, &#34;duration&#34;: &#34;00:00:03&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_trackingid_absent&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:03&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 23 in scenario &amp;quot;trackingId absent&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/trackingId.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:9218/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:9177 ...\n2026-01-15 10:26:41,488 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:26:41,488 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9177 ...\n2026-01-15 10:26:41,507 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\nConnecting to NATS nats://localhost:9177 ...\n2026-01-15 10:26:41,507 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:26:41,507 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:26:41,508 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9177 ...\n2026-01-15 10:26:41,520 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-15 10:26:41,520 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9177 ...\n2026-01-15 10:26:41,539 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:26:41,539 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9177 ...\n2026-01-15 10:26:41,620 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:26:41,621 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:26:41,621 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:41,622 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:41,622 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:41,622 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:41,622 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:26:41,623 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:41,623 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:41,623 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:26:41,623 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:26:41,624 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:41,624 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:41,624 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:26:41,624 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:9177 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:9218\n    server   Documentation at http://0.0.0.0:9218/docs\n \n             Logs:\n \n2026-01-15 10:26:41,781 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:26:41,784 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:26:41,784 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:26:41,786 INFO     - *                | 72ac6d03-5 - Received\n2026-01-15 10:26:41,789 INFO     - *                | 72ac6d03-5 - Processed\n_check_http_health http://localhost:9218/healthcheck\n      INFO   127.0.0.1:42842 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:42850 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[35464] 2026/01/15 10:26:41.107186 [INF] Starting nats-server\n[35464] 2026/01/15 10:26:41.107254 [INF]   Version:  2.12.3\n[35464] 2026/01/15 10:26:41.107257 [INF]   Git:      [450a519]\n[35464] 2026/01/15 10:26:41.107260 [INF]   Name:     NAVESEBP43VDBJVDHOVGZRTH4PMFA3WHTDMJ56Q4DLMXG4TU56XHTGM6\n[35464] 2026/01/15 10:26:41.107271 [INF]   ID:       NAVESEBP43VDBJVDHOVGZRTH4PMFA3WHTDMJ56Q4DLMXG4TU56XHTGM6\n[35464] 2026/01/15 10:26:41.107743 [INF] Listening for client connections on 0.0.0.0:9177\n[35464] 2026/01/15 10:26:41.108032 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\n2026-01-15 10:26:41,484 INFO     - FastStream app starting...\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:26:41,488 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:41,503 INFO     - FastStream app starting...\n2026-01-15 10:26:41,504 INFO     - FastStream app starting...\n2026-01-15 10:26:41,508 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:41,508 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:41,516 INFO     - FastStream app starting...\n2026-01-15 10:26:41,520 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:41,535 INFO     - FastStream app starting...\n2026-01-15 10:26:41,539 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:41,617 INFO     - FastStream app starting...\n2026-01-15 10:26:41,624 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [35496]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:9218 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8364 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:8364\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 9177 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:9177\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 9218 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 9285 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:9285\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 9244 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:9244\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 8732 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:8732\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 8586 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:8586\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8711 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:8711\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 8754 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:8754\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 9299 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:9299\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9218 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9218 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x73499bad2c10&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:41 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:9218/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:9218\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9218 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x73499bbdc190&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:41 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:9218/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [35496]\n2026-01-15 10:26:42,487 INFO     - FastStream app shutting down...\n2026-01-15 10:26:42,488 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:42,707 INFO     - FastStream app shutting down...\n2026-01-15 10:26:42,708 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:42,907 INFO     - FastStream app shutting down...\n2026-01-15 10:26:42,908 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:43,120 INFO     - FastStream app shutting down...\n2026-01-15 10:26:43,121 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:43,340 INFO     - FastStream app shutting down...\n2026-01-15 10:26:43,341 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:43,522 INFO     - FastStream app shutting down...\n2026-01-15 10:26:43,523 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_trackingid_doublon&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_trackingid_doublon&#34;, &#34;duration&#34;: &#34;00:00:03&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_trackingid_doublon&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:03&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 32 in scenario &amp;quot;trackingId doublon&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/trackingId.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:9128/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8985 ...\n2026-01-15 10:26:44,199 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:26:44,199 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8985 ...\n2026-01-15 10:26:44,200 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:26:44,200 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8985 ...\n2026-01-15 10:26:44,210 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:26:44,210 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8985 ...\n2026-01-15 10:26:44,226 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-15 10:26:44,227 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8985 ...\n2026-01-15 10:26:44,249 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:26:44,249 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8985 ...\n2026-01-15 10:26:44,253 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:26:44,254 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:26:44,254 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:44,254 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:44,255 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:44,255 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:44,255 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:26:44,256 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:44,256 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:44,256 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:26:44,257 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:26:44,257 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:44,258 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:44,258 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:26:44,258 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8985 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:9128\n    server   Documentation at http://0.0.0.0:9128/docs\n \n             Logs:\n \n2026-01-15 10:26:44,416 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:26:44,417 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:26:44,418 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:26:44,419 INFO     - *                | acc2f29f-e - Received\n2026-01-15 10:26:44,422 INFO     - *                | acc2f29f-e - Processed\n_check_http_health http://localhost:9128/healthcheck\n      INFO   127.0.0.1:51674 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:51676 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[35553] 2026/01/15 10:26:43.698501 [INF] Starting nats-server\n[35553] 2026/01/15 10:26:43.698598 [INF]   Version:  2.12.3\n[35553] 2026/01/15 10:26:43.698604 [INF]   Git:      [450a519]\n[35553] 2026/01/15 10:26:43.698608 [INF]   Name:     NACQQHOUSOU6ICMRSRW2LA6SMH3WF5A4EE3DP6XU32FG6GFZKSCLLEPZ\n[35553] 2026/01/15 10:26:43.698631 [INF]   ID:       NACQQHOUSOU6ICMRSRW2LA6SMH3WF5A4EE3DP6XU32FG6GFZKSCLLEPZ\n[35553] 2026/01/15 10:26:43.699999 [INF] Listening for client connections on 0.0.0.0:8985\n[35553] 2026/01/15 10:26:43.700805 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\n2026-01-15 10:26:44,195 INFO     - FastStream app starting...\n2026-01-15 10:26:44,197 INFO     - FastStream app starting...\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:26:44,199 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:44,201 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:44,206 INFO     - FastStream app starting...\n2026-01-15 10:26:44,211 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:44,223 INFO     - FastStream app starting...\n2026-01-15 10:26:44,227 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:44,246 INFO     - FastStream app starting...\n2026-01-15 10:26:44,249 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:44,250 INFO     - FastStream app starting...\n2026-01-15 10:26:44,258 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [35574]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:9128 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8946 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:8946\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8985 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:8985\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 9128 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8738 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:8738\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 9028 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:9028\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 8515 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:8515\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 9003 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:9003\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8980 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:8980\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 8579 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:8579\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 9097 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:9097\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9128 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9128 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x73499bad2d50&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:44 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:9128/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:9128\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=9128 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x73499bad2710&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:44 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:9128/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [35574]\n2026-01-15 10:26:45,099 INFO     - FastStream app shutting down...\n2026-01-15 10:26:45,100 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:45,298 INFO     - FastStream app shutting down...\n2026-01-15 10:26:45,299 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:45,509 INFO     - FastStream app shutting down...\n2026-01-15 10:26:45,510 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:45,727 INFO     - FastStream app shutting down...\n2026-01-15 10:26:45,728 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:45,951 INFO     - FastStream app shutting down...\n2026-01-15 10:26:45,953 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:46,155 INFO     - FastStream app shutting down...\n2026-01-15 10:26:46,157 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_api_gateway&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_api_gateway&#34;, &#34;duration&#34;: &#34;00:00:01&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marragearr\u00eat_service_api_gateway&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:01&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:8388/healthcheck\ncccccc All connection attempts failed\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8387 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8388\n    server   Documentation at http://0.0.0.0:8388/docs\n \n             Logs:\n \n2026-01-15 10:26:47,067 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:26:47,069 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:26:47,069 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:26:47,071 INFO     - *                | 5e26bcbd-1 - Received\n2026-01-15 10:26:47,074 INFO     - *                | 5e26bcbd-1 - Processed\n_check_http_health http://localhost:8388/healthcheck\n      INFO   127.0.0.1:37680 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[35638] 2026/01/15 10:26:46.269286 [INF] Starting nats-server\n[35638] 2026/01/15 10:26:46.269374 [INF]   Version:  2.12.3\n[35638] 2026/01/15 10:26:46.269380 [INF]   Git:      [450a519]\n[35638] 2026/01/15 10:26:46.269384 [INF]   Name:     NDAHAHWLHDOTUSE3C34ENHFPVFZEWBJ45K6B2XIGIVDLIS6BSVV5AUMG\n[35638] 2026/01/15 10:26:46.269397 [INF]   ID:       NDAHAHWLHDOTUSE3C34ENHFPVFZEWBJ45K6B2XIGIVDLIS6BSVV5AUMG\n[35638] 2026/01/15 10:26:46.270134 [INF] Listening for client connections on 0.0.0.0:8387\n[35638] 2026/01/15 10:26:46.270530 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n      INFO   Started server process [35650]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8388 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service None on port 8387 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready None ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  None started on localhost:8387\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;01-api-gateway&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;01-api-gateway&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je lance le service &amp;quot;01-api-gateway&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je lance le service &amp;quot;01-api-gateway&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8388 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8388 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8388 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x73499bacda70&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:47 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8388/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:8388\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;01-api-gateway&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;01-api-gateway&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [35650]\n[35638] 2026/01/15 10:26:47.525487 [INF] Trapped &amp;quot;terminated&amp;quot; signal\n[35638] 2026/01/15 10:26:47.525731 [INF] Initiating Shutdown...\n[35638] 2026/01/15 10:26:47.525851 [INF] Server Exiting..\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...&#34;}], &#34;test_scenario.py::test_contr\u00f4le_sha256&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_contr\u00f4le_sha256&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_contr\u00f4le_sha256&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;je joins le fichier /data/FA-3647.pdf&amp;quot;. Line 9 in scenario &amp;quot;Contr\u00f4le sha256&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/01-api-gateway/sha256.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n\n----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:8620/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:9198 ...\n2026-01-15 10:26:48,128 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:26:48,129 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9198 ...\n2026-01-15 10:26:48,132 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:26:48,132 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9198 ...\n2026-01-15 10:26:48,146 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-15 10:26:48,146 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9198 ...\n2026-01-15 10:26:48,150 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:26:48,150 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9198 ...\n2026-01-15 10:26:48,164 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\nConnecting to NATS nats://localhost:9198 ...\n2026-01-15 10:26:48,164 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:26:48,164 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:26:48,164 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:26:48,165 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:48,165 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:48,166 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:48,166 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:48,166 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:26:48,167 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:48,167 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:48,167 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:26:48,168 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:26:48,168 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:48,169 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:48,169 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:26:48,169 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:9198 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8620\n    server   Documentation at http://0.0.0.0:8620/docs\n \n             Logs:\n \n2026-01-15 10:26:48,331 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:26:48,333 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:26:48,334 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:26:48,335 INFO     - *                | c2e631df-b - Received\n2026-01-15 10:26:48,338 INFO     - *                | c2e631df-b - Processed\n_check_http_health http://localhost:8620/healthcheck\n      INFO   127.0.0.1:57370 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:57384 - &amp;quot;POST /flows HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[35664] 2026/01/15 10:26:47.547861 [INF] Starting nats-server\n[35664] 2026/01/15 10:26:47.547940 [INF]   Version:  2.12.3\n[35664] 2026/01/15 10:26:47.547946 [INF]   Git:      [450a519]\n[35664] 2026/01/15 10:26:47.547951 [INF]   Name:     NACA5UGGCRK5SEFWZXTIPDN4WQUZRC3TIMJOSCCAQ6V5GHLTPOHEEGWE\n[35664] 2026/01/15 10:26:47.547956 [INF]   ID:       NACA5UGGCRK5SEFWZXTIPDN4WQUZRC3TIMJOSCCAQ6V5GHLTPOHEEGWE\n[35664] 2026/01/15 10:26:47.548678 [INF] Listening for client connections on 0.0.0.0:9198\n[35664] 2026/01/15 10:26:47.549097 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:26:48,124 INFO     - FastStream app starting...\n2026-01-15 10:26:48,127 INFO     - FastStream app starting...\n2026-01-15 10:26:48,129 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:48,132 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:48,142 INFO     - FastStream app starting...\n2026-01-15 10:26:48,146 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:48,147 INFO     - FastStream app starting...\n2026-01-15 10:26:48,151 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:48,160 INFO     - FastStream app starting...\n2026-01-15 10:26:48,161 INFO     - FastStream app starting...\n2026-01-15 10:26:48,165 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:48,169 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [35682]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8620 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API POST /flows&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 9086 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:9086\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 9198 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:9198\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8620 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8329 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:8329\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 8843 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:8843\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 8458 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:8458\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 8422 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:8422\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8876 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:8876\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 8684 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:8684\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 8955 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:8955\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8620 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8620 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x73499bacc2b0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:48 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8620/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:8620\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8620 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x73499bb30d60&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:48 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;17&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8620/flows &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [35682]\n2026-01-15 10:26:48,929 INFO     - FastStream app shutting down...\n2026-01-15 10:26:48,930 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:49,050 INFO     - FastStream app shutting down...\n2026-01-15 10:26:49,051 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:49,231 INFO     - FastStream app shutting down...\n2026-01-15 10:26:49,232 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:49,447 INFO     - FastStream app shutting down...\n2026-01-15 10:26:49,449 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:49,667 INFO     - FastStream app shutting down...\n2026-01-15 10:26:49,668 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:49,866 INFO     - FastStream app shutting down...\n2026-01-15 10:26:49,868 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_healthcheck&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_healthcheck&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_healthcheck&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:8917/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8783 ...\n2026-01-15 10:26:50,619 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-15 10:26:50,620 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8783 ...\n2026-01-15 10:26:50,624 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:26:50,625 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8783 ...\n2026-01-15 10:26:50,626 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:26:50,627 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8783 ...\n2026-01-15 10:26:50,658 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:26:50,659 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:26:50,659 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:50,660 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:50,660 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:50,661 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:50,661 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\nConnecting to NATS nats://localhost:8783 ...\n2026-01-15 10:26:50,661 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:26:50,661 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:50,662 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:26:50,662 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:50,662 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:26:50,662 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:26:50,663 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:50,663 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:50,664 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:26:50,664 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8783 ...\n2026-01-15 10:26:50,668 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:26:50,668 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8783 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8917\n    server   Documentation at http://0.0.0.0:8917/docs\n \n             Logs:\n \n2026-01-15 10:26:50,862 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:26:50,864 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:26:50,864 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:26:50,865 INFO     - *                | 626bef08-f - Received\n2026-01-15 10:26:50,869 INFO     - *                | 626bef08-f - Processed\n_check_http_health http://localhost:8917/healthcheck\n      INFO   127.0.0.1:59852 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:59858 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[35747] 2026/01/15 10:26:50.031338 [INF] Starting nats-server\n[35747] 2026/01/15 10:26:50.031426 [INF]   Version:  2.12.3\n[35747] 2026/01/15 10:26:50.031432 [INF]   Git:      [450a519]\n[35747] 2026/01/15 10:26:50.031436 [INF]   Name:     NCDJSP47CU2NWPT3IDN55Q4ZRZ264RNZVTNLCEN6QLF7HFSSTGTYLZI2\n[35747] 2026/01/15 10:26:50.031449 [INF]   ID:       NCDJSP47CU2NWPT3IDN55Q4ZRZ264RNZVTNLCEN6QLF7HFSSTGTYLZI2\n[35747] 2026/01/15 10:26:50.032129 [INF] Listening for client connections on 0.0.0.0:8783\n[35747] 2026/01/15 10:26:50.032563 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:26:50,614 INFO     - FastStream app starting...\n2026-01-15 10:26:50,619 INFO     - FastStream app starting...\n2026-01-15 10:26:50,620 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:50,622 INFO     - FastStream app starting...\n2026-01-15 10:26:50,625 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:50,627 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:50,655 INFO     - FastStream app starting...\n2026-01-15 10:26:50,658 INFO     - FastStream app starting...\n2026-01-15 10:26:50,662 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:50,664 INFO     - FastStream app starting...\n2026-01-15 10:26:50,664 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:50,669 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [35762]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8917 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_une pa communautaire&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_une pa communautaire&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 9049 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:9049\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8783 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:8783\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8917 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8763 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:8763\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 8755 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:8755\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 8623 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:8623\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 8803 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:8803\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8996 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:8996\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 8530 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:8530\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 8857 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:8857\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8917 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8917 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x73499baead50&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:50 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8917/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:8917\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API GET /healthcheck&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8917 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x73499bb328b0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:50 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8917/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;obtiens le code de retour 200&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;obtiens le code de retour {code}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [35762]\n2026-01-15 10:26:51,323 INFO     - FastStream app shutting down...\n2026-01-15 10:26:51,325 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:51,560 INFO     - FastStream app shutting down...\n2026-01-15 10:26:51,561 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:51,730 INFO     - FastStream app shutting down...\n2026-01-15 10:26:51,731 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:51,917 INFO     - FastStream app shutting down...\n2026-01-15 10:26:51,919 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:52,066 INFO     - FastStream app shutting down...\n2026-01-15 10:26:52,067 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:52,262 INFO     - FastStream app shutting down...\n2026-01-15 10:26:52,263 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_healthcheck_deep&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_healthcheck_deep&#34;, &#34;duration&#34;: &#34;00:00:05&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_healthcheck_deep&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:05&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:8812/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:9035 ...\n2026-01-15 10:26:52,963 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:26:52,964 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9035 ...\n2026-01-15 10:26:52,974 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:26:52,975 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9035 ...\n2026-01-15 10:26:52,989 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:26:52,990 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9035 ...\n2026-01-15 10:26:52,994 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-15 10:26:52,995 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9035 ...\n2026-01-15 10:26:53,002 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:26:53,002 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9035 ...\n2026-01-15 10:26:53,022 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:26:53,023 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:26:53,023 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:53,024 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:53,024 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:53,024 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:53,025 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:26:53,025 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:53,026 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:53,026 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:26:53,026 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:26:53,027 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:53,027 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:53,028 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:26:53,028 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:9035 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8812\n    server   Documentation at http://0.0.0.0:8812/docs\n \n             Logs:\n \n2026-01-15 10:26:53,202 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:26:53,204 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:26:53,204 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:26:53,206 INFO     - *                | ee4cca7c-1 - Received\n2026-01-15 10:26:53,209 INFO     - *                | ee4cca7c-1 - Processed\n_check_http_health http://localhost:8812/healthcheck\n      INFO   127.0.0.1:53272 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n2026-01-15 10:26:53,551 INFO     -   | healthcheck         | 600b82fe-d - Received\n2026-01-15 10:26:53,551 INFO     -   | healthcheck           | 600b82fe-d - Received\n2026-01-15 10:26:53,551 INFO     -   | healthcheck             | 600b82fe-d - Received\n2026-01-15 10:26:53,551 INFO     -   | healthcheck              | 600b82fe-d - Received\n2026-01-15 10:26:53,551 INFO     - healthcheck      | 600b82fe-d - Received\n2026-01-15 10:26:53,552 INFO     -   | healthcheck         | 600b82fe-d - Processed\n2026-01-15 10:26:53,552 INFO     -   | healthcheck | 600b82fe-d - Received\n2026-01-15 10:26:53,552 INFO     -   | healthcheck          | 600b82fe-d - Received\n2026-01-15 10:26:53,552 INFO     - healthcheck      | 600b82fe-d - Processed\n2026-01-15 10:26:53,552 INFO     -   | healthcheck           | 600b82fe-d - Processed\n2026-01-15 10:26:53,552 INFO     -   | healthcheck             | 600b82fe-d - Processed\n2026-01-15 10:26:53,552 INFO     -   | healthcheck              | 600b82fe-d - Processed\n2026-01-15 10:26:53,552 INFO     -   | healthcheck          | 600b82fe-d - Processed\n2026-01-15 10:26:53,552 INFO     -   | healthcheck | 600b82fe-d - Processed\n2026-01-15 10:26:53,552 INFO     - *                | 600b82fe-d - Received\n2026-01-15 10:26:53,553 INFO     - healthcheck_resp | b11f3837-0 - Received\n2026-01-15 10:26:53,553 INFO     - healthcheck_resp | b11f3837-0 - Processed\n2026-01-15 10:26:53,553 INFO     - healthcheck_resp | 49649e0c-3 - Received\n2026-01-15 10:26:53,554 INFO     - healthcheck_resp | 49649e0c-3 - Processed\n2026-01-15 10:26:53,554 INFO     - healthcheck_resp | 96843fe9-6 - Received\n2026-01-15 10:26:53,554 INFO     - healthcheck_resp | 96843fe9-6 - Processed\n2026-01-15 10:26:53,554 INFO     - healthcheck_resp | 23418c82-9 - Received\n2026-01-15 10:26:53,554 INFO     - healthcheck_resp | 23418c82-9 - Processed\n2026-01-15 10:26:53,554 INFO     - healthcheck_resp | 988bf335-f - Received\n2026-01-15 10:26:53,554 INFO     - healthcheck_resp | 988bf335-f - Processed\n2026-01-15 10:26:53,555 INFO     - healthcheck_resp | ce4e2c69-9 - Received\n2026-01-15 10:26:53,555 INFO     - healthcheck_resp | ce4e2c69-9 - Processed\n2026-01-15 10:26:53,555 INFO     - healthcheck_resp | 972909f3-8 - Received\n2026-01-15 10:26:53,555 INFO     - healthcheck_resp | 972909f3-8 - Processed\n2026-01-15 10:26:53,555 INFO     - *                | 600b82fe-d - Processed\n2026-01-15 10:26:53,555 INFO     - *                | b11f3837-0 - Received\n2026-01-15 10:26:53,555 INFO     - *                | b11f3837-0 - Processed\n2026-01-15 10:26:53,556 INFO     - *                | 49649e0c-3 - Received\n2026-01-15 10:26:53,556 INFO     - *                | 49649e0c-3 - Processed\n2026-01-15 10:26:53,556 INFO     - *                | 96843fe9-6 - Received\n2026-01-15 10:26:53,556 INFO     - *                | 96843fe9-6 - Processed\n2026-01-15 10:26:53,556 INFO     - *                | 23418c82-9 - Received\n2026-01-15 10:26:53,556 INFO     - *                | 23418c82-9 - Processed\n2026-01-15 10:26:53,557 INFO     - *                | 988bf335-f - Received\n2026-01-15 10:26:53,557 INFO     - *                | 988bf335-f - Processed\n2026-01-15 10:26:53,557 INFO     - *                | ce4e2c69-9 - Received\n2026-01-15 10:26:53,557 INFO     - *                | ce4e2c69-9 - Processed\n2026-01-15 10:26:53,557 INFO     - *                | 972909f3-8 - Received\n2026-01-15 10:26:53,557 INFO     - *                | 972909f3-8 - Processed\n      INFO   127.0.0.1:53280 - &amp;quot;GET /healthcheck/deep HTTP/1.1&amp;quot; 200\n\n----------------------------- Captured stderr call -----------------------------\n[35831] 2026/01/15 10:26:52.405279 [INF] Starting nats-server\n[35831] 2026/01/15 10:26:52.405407 [INF]   Version:  2.12.3\n[35831] 2026/01/15 10:26:52.405414 [INF]   Git:      [450a519]\n[35831] 2026/01/15 10:26:52.405419 [INF]   Name:     NBR2QEUU5PRS7WH76IYLOMF6AN7OUUFKCPHEB6KD4SW7LXITYHN2N2W2\n[35831] 2026/01/15 10:26:52.405433 [INF]   ID:       NBR2QEUU5PRS7WH76IYLOMF6AN7OUUFKCPHEB6KD4SW7LXITYHN2N2W2\n[35831] 2026/01/15 10:26:52.406317 [INF] Listening for client connections on 0.0.0.0:9035\n[35831] 2026/01/15 10:26:52.406778 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n2026-01-15 10:26:52,959 INFO     - FastStream app starting...\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:26:52,964 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:52,971 INFO     - FastStream app starting...\n2026-01-15 10:26:52,975 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:52,985 INFO     - FastStream app starting...\n2026-01-15 10:26:52,990 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:52,991 INFO     - FastStream app starting...\n2026-01-15 10:26:52,995 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:52,998 INFO     - FastStream app starting...\n2026-01-15 10:26:53,002 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:53,019 INFO     - FastStream app starting...\n2026-01-15 10:26:53,028 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [35846]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8812 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_une pa communautaire&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_une pa communautaire&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 9240 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:9240\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 9035 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:9035\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8812 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8311 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:8311\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 9026 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:9026\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 8459 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:8459\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 8741 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:8741\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8867 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:8867\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 8998 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:8998\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 8508 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:8508\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8812 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8812 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x73499ba0fce0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:53 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8812/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:8812\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;appele l&amp;#x27;API GET /healthcheck/deep&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;appele l&amp;#x27;API {verb} {path}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8812 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x73499baea450&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:53 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;84&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8812/healthcheck/deep &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;obtiens le code de retour 200&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;obtiens le code de retour {code}&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_la r\u00e9ponse a une cl\u00e9 &amp;quot;healthcheck_resp&amp;quot; avec 7 \u00e9l\u00e9ments&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_la r\u00e9ponse a une cl\u00e9 &amp;quot;{key}&amp;quot; avec {nb} \u00e9l\u00e9ments&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [35846]\n2026-01-15 10:26:55,882 INFO     - FastStream app shutting down...\n2026-01-15 10:26:55,883 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:56,072 INFO     - FastStream app shutting down...\n2026-01-15 10:26:56,073 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:56,308 INFO     - FastStream app shutting down...\n2026-01-15 10:26:56,310 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:56,502 INFO     - FastStream app shutting down...\n2026-01-15 10:26:56,503 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:56,697 INFO     - FastStream app shutting down...\n2026-01-15 10:26:56,698 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:56,832 INFO     - FastStream app shutting down...\n2026-01-15 10:26:56,834 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_controle_formats&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_controle_formats&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marragearr\u00eat_service_controle_formats&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When &amp;quot;le service &amp;quot;03-controle-formats&amp;quot; n&amp;#x27;est pas pr\u00eat&amp;quot;. Line 6 in scenario &amp;quot;d\u00e9marrage/arr\u00eat service controle formats&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/03-controle-formats/service.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_controle_format_facturx&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_controle_format_facturx&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_controle_format_facturx&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function control_invoice at 0x73499c508900&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_controle_format_facturx&amp;gt;&amp;gt;, kwargs = {}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @when(\n        parsers.parse(&amp;quot;je d\u00e9pose pour contr\u00f4le la facture @{invoice}&amp;quot;),\n    )\n    def control_invoice():\n&amp;gt;       raise NotImplementedError()\nE       NotImplementedError\n\nsrc/pac_bdd/tobeimplemented.py:30: NotImplementedError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je d\u00e9pose pour contr\u00f4le la facture @FA213746_20251211_124749.pdf&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je d\u00e9pose pour contr\u00f4le la facture @{invoice}&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_serveur_nats&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_serveur_nats&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_serveur_nats&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un serveur NATS disponible&amp;quot;. Line 19 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un serveur NATS&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/service_lifecycle.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_connexion_dun_broker_au_serveur_nats&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_connexion_dun_broker_au_serveur_nats&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_connexion_dun_broker_au_serveur_nats&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un serveur NATS disponible&amp;quot;. Line 23 in scenario &amp;quot;Connexion d&amp;#x27;un broker au serveur NATS&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/service_lifecycle.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_de_plusieurs_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_de_plusieurs_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_de_plusieurs_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;2 PA d\u00e9marr\u00e9es&amp;quot;. Line 32 in scenario &amp;quot;D\u00e9marrage de plusieurs PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/service_lifecycle.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_service_nats_local&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_service_nats_local&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_service_nats_local&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service NATS local&amp;quot;. Line 21 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un service NATS local&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_connexion_\u00e0_un_service_nats_distant&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_connexion_\u00e0_un_service_nats_distant&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_connexion_\u00e0_un_service_nats_distant&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service NATS local comme r\u00e9f\u00e9rence&amp;quot;. Line 27 in scenario &amp;quot;Connexion \u00e0 un service NATS distant&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_service_peppol_mock&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_service_peppol_mock&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_service_peppol_mock&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock&amp;quot;. Line 33 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un service Peppol mock&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_configuration_des_r\u00e9ponses_peppol_mock&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_configuration_des_r\u00e9ponses_peppol_mock&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_configuration_des_r\u00e9ponses_peppol_mock&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock&amp;quot;. Line 38 in scenario &amp;quot;Configuration des r\u00e9ponses Peppol mock&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_recherche_peppol_dune_entreprise_non_enregistr\u00e9e&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_recherche_peppol_dune_entreprise_non_enregistr\u00e9e&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_recherche_peppol_dune_entreprise_non_enregistr\u00e9e&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock&amp;quot;. Line 45 in scenario &amp;quot;Recherche Peppol d&amp;#x27;une entreprise non enregistr\u00e9e&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marrage_dun_service_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marrage_dun_service_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marrage_dun_service_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service PA&amp;quot;. Line 51 in scenario &amp;quot;D\u00e9marrage d&amp;#x27;un service PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_1_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_1_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_1_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 1 PA&amp;quot;. Line 61 in scenario &amp;quot;Cr\u00e9ation d&amp;#x27;un monde avec 1 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_2_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_2_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_2_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 68 in scenario &amp;quot;Cr\u00e9ation d&amp;#x27;un monde avec 2 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_4_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_4_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_cr\u00e9ation_dun_monde_avec_4_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 4 PA&amp;quot;. Line 74 in scenario &amp;quot;Cr\u00e9ation d&amp;#x27;un monde avec 4 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_les_pa_partagent_le_m\u00eame_service_nats&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_les_pa_partagent_le_m\u00eame_service_nats&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_les_pa_partagent_le_m\u00eame_service_nats&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 82 in scenario &amp;quot;Les PA partagent le m\u00eame service NATS&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_les_pa_ont_des_ports_api_distincts&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_les_pa_ont_des_ports_api_distincts&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_les_pa_ont_des_ports_api_distincts&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 3 PA&amp;quot;. Line 87 in scenario &amp;quot;Les PA ont des ports API distincts&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_toutes_les_pa_r\u00e9pondent_au_healthcheck&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_toutes_les_pa_r\u00e9pondent_au_healthcheck&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_toutes_les_pa_r\u00e9pondent_au_healthcheck&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 95 in scenario &amp;quot;Toutes les PA r\u00e9pondent au healthcheck&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_information_du_monde&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_information_du_monde&#34;, &#34;duration&#34;: &#34;0 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_information_du_monde&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;0 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 104 in scenario &amp;quot;Information du monde&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_arr\u00eat_propre_du_monde&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_arr\u00eat_propre_du_monde&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_arr\u00eat_propre_du_monde&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA d\u00e9marr\u00e9&amp;quot;. Line 115 in scenario &amp;quot;Arr\u00eat propre du monde&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_monde_avec_nats_externe&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_monde_avec_nats_externe&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_monde_avec_nats_externe&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service NATS local comme r\u00e9f\u00e9rence&amp;quot;. Line 126 in scenario &amp;quot;Monde avec NATS externe&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_monde_avec_peppol_personnalis\u00e9&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_monde_avec_peppol_personnalis\u00e9&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_monde_avec_peppol_personnalis\u00e9&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un service Peppol en mode mock comme r\u00e9f\u00e9rence&amp;quot;. Line 132 in scenario &amp;quot;Monde avec Peppol personnalis\u00e9&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9p\u00f4t_de_facture_entre_2_pa_via_peppol&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9p\u00f4t_de_facture_entre_2_pa_via_peppol&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9p\u00f4t_de_facture_entre_2_pa_via_peppol&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;un monde avec 2 PA&amp;quot;. Line 141 in scenario &amp;quot;D\u00e9p\u00f4t de facture entre 2 PA via Peppol&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/02-esb-central/world.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_esb_central&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_d\u00e9marragearr\u00eat_service_esb_central&#34;, &#34;duration&#34;: &#34;5 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_d\u00e9marragearr\u00eat_service_esb_central&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;5 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_le service &amp;quot;02-esb-central&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_le service &amp;quot;02-esb-central&amp;quot; n\\&amp;#x27;est pas pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je lance le service &amp;quot;02-esb-central&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service None on port 9272 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready None ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  None started on localhost:9272\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_le service &amp;quot;02-esb-central&amp;quot; est pr\u00eat&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...&#34;}], &#34;test_scenario.py::test_healthcheck_message&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_healthcheck_message&#34;, &#34;duration&#34;: &#34;00:00:03&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_healthcheck_message&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:03&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function _ at 0x73499c69cae0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_healthcheck_message&amp;gt;&amp;gt;, kwargs = {&amp;#x27;canal&amp;#x27;: &amp;#x27;healthcheck_resp&amp;#x27;, &amp;#x27;msg&amp;#x27;: &amp;#x27;toto&amp;#x27;, &amp;#x27;world1&amp;#x27;: WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceCon...tream.FastStreamServiceContext object at 0x73499babd400&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x73499ba8e210&amp;gt;)])}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nworld1 = WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x73499bb41040&amp;gt;, pas=[PacServiceContext(...stream.FastStreamServiceContext object at 0x73499babd400&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x73499ba8e210&amp;gt;)]), msg = &amp;#x27;toto&amp;#x27;, canal = &amp;#x27;healthcheck_resp&amp;#x27;\n\n    @then(parsers.parse(&amp;quot;&amp;quot;&amp;quot;j&amp;#x27;obtiens le message &amp;#x27;{msg}&amp;#x27; sur le canal &amp;#x27;{canal}&amp;#x27;&amp;quot;&amp;quot;&amp;quot;))\n    def _(\n        world1: WorldContext,\n        msg: str,\n        canal: str,\n    ):\n        traces = []\n        with world1.pa1.api_gateway.get_client() as client:\n            response = client.get(&amp;quot;/trace&amp;quot;)\n            assert response.status_code == 200\n            traces = response.json()\n    \n        for trace in traces:\n            print(trace)\n            if trace[&amp;quot;subject&amp;quot;] == canal and trace[&amp;quot;body&amp;quot;] == msg:\n                return\n        else:\n&amp;gt;           raise Exception(&amp;quot;message not found !&amp;quot;)\nE           Exception: message not found !\n\nsrc/pac_bdd/esb.py:78: Exception\n\n----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:8405/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8910 ...\n2026-01-15 10:26:57,600 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:26:57,600 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8910 ...\n2026-01-15 10:26:57,605 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:26:57,606 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8910 ...\n2026-01-15 10:26:57,622 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-15 10:26:57,623 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8910 ...\n2026-01-15 10:26:57,632 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:26:57,632 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8910 ...\n2026-01-15 10:26:57,632 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:26:57,633 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:26:57,633 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:57,634 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:57,634 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:57,635 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:57,635 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:26:57,635 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:57,636 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:57,636 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:26:57,637 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:26:57,637 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:57,637 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:26:57,638 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:26:57,638 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8910 ...\n2026-01-15 10:26:57,649 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:26:57,649 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8910 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8405\n    server   Documentation at http://0.0.0.0:8405/docs\n \n             Logs:\n \n2026-01-15 10:26:57,831 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:26:57,833 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:26:57,833 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:26:57,834 INFO     - *                | f7076706-b - Received\n2026-01-15 10:26:57,837 INFO     - *                | f7076706-b - Processed\n_check_http_health http://localhost:8405/healthcheck\n      INFO   127.0.0.1:36712 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:36728 - &amp;quot;POST /publish HTTP/1.1&amp;quot; 200\n2026-01-15 10:26:58,216 INFO     - *                | 17d3236e-0 - Received\n2026-01-15 10:26:58,216 INFO     - *                | 17d3236e-0 - Processed\n      INFO   127.0.0.1:36732 - &amp;quot;GET /trace HTTP/1.1&amp;quot; 200\n{&amp;#x27;body&amp;#x27;: &amp;#x27;Startup!!!&amp;#x27;, &amp;#x27;content_type&amp;#x27;: &amp;#x27;text/plain&amp;#x27;, &amp;#x27;message_id&amp;#x27;: &amp;#x27;f7076706-b8f8-4bc9-afa6-3e4499fb3eb5&amp;#x27;, &amp;#x27;correlation_id&amp;#x27;: &amp;#x27;f7076706-b8f8-4bc9-afa6-3e4499fb3eb5&amp;#x27;, &amp;#x27;path&amp;#x27;: {}, &amp;#x27;committed&amp;#x27;: None, &amp;#x27;subject&amp;#x27;: &amp;#x27;test&amp;#x27;, &amp;#x27;reply&amp;#x27;: &amp;#x27;&amp;#x27;}\n{&amp;#x27;body&amp;#x27;: &amp;#x27;publishing ...&amp;#x27;, &amp;#x27;content_type&amp;#x27;: &amp;#x27;text/plain&amp;#x27;, &amp;#x27;message_id&amp;#x27;: &amp;#x27;17d3236e-00d4-4cf2-bad3-52461a203512&amp;#x27;, &amp;#x27;correlation_id&amp;#x27;: &amp;#x27;17d3236e-00d4-4cf2-bad3-52461a203512&amp;#x27;, &amp;#x27;path&amp;#x27;: {}, &amp;#x27;committed&amp;#x27;: None, &amp;#x27;subject&amp;#x27;: &amp;#x27;xxx&amp;#x27;, &amp;#x27;reply&amp;#x27;: &amp;#x27;&amp;#x27;}\n\n----------------------------- Captured stderr call -----------------------------\n[35923] 2026/01/15 10:26:57.060898 [INF] Starting nats-server\n[35923] 2026/01/15 10:26:57.060978 [INF]   Version:  2.12.3\n[35923] 2026/01/15 10:26:57.060984 [INF]   Git:      [450a519]\n[35923] 2026/01/15 10:26:57.060988 [INF]   Name:     NB722WS6I76JVRPSDOOPNSTPV756BGK3PJTIMFFYXENI5DNDOITS2NNU\n[35923] 2026/01/15 10:26:57.060992 [INF]   ID:       NB722WS6I76JVRPSDOOPNSTPV756BGK3PJTIMFFYXENI5DNDOITS2NNU\n[35923] 2026/01/15 10:26:57.061759 [INF] Listening for client connections on 0.0.0.0:8910\n[35923] 2026/01/15 10:26:57.062176 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:26:57,596 INFO     - FastStream app starting...\n2026-01-15 10:26:57,601 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:57,602 INFO     - FastStream app starting...\n2026-01-15 10:26:57,606 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:57,618 INFO     - FastStream app starting...\n2026-01-15 10:26:57,623 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:57,628 INFO     - FastStream app starting...\n2026-01-15 10:26:57,629 INFO     - FastStream app starting...\n2026-01-15 10:26:57,632 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:57,638 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:26:57,646 INFO     - FastStream app starting...\n2026-01-15 10:26:57,650 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [35944]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8405 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_je publie le message &amp;#x27;hello&amp;#x27; sur le canal &amp;#x27;healthcheck&amp;#x27;&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_je publie le message &amp;#x27;{msg}&amp;#x27; sur le canal &amp;#x27;{canal}&amp;#x27;&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8627 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:8627\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8910 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:8910\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8405 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8824 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:8824\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 8797 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:8797\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 8568 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:8568\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 9267 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:9267\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 9264 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:9264\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 8982 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:8982\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 8479 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:8479\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8405 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8405 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x73499ba0ecf0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:57 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8405/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:8405\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8405 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x73499bd82580&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:57 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;4&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8405/publish &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;obtiens le message &amp;#x27;toto&amp;#x27; sur le canal &amp;#x27;healthcheck_resp&amp;#x27;&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;obtiens le message &amp;#x27;{msg}&amp;#x27; sur le canal &amp;#x27;{canal}&amp;#x27;&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8405 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x73499bac6ad0&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:26:57 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;430&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8405/trace &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [35944]\n2026-01-15 10:26:58,499 INFO     - FastStream app shutting down...\n2026-01-15 10:26:58,501 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:58,704 INFO     - FastStream app shutting down...\n2026-01-15 10:26:58,705 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:58,934 INFO     - FastStream app shutting down...\n2026-01-15 10:26:58,936 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:59,122 INFO     - FastStream app shutting down...\n2026-01-15 10:26:59,123 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:59,351 INFO     - FastStream app shutting down...\n2026-01-15 10:26:59,353 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:26:59,535 INFO     - FastStream app shutting down...\n2026-01-15 10:26:59,536 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_canal_pingpong&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_canal_pingpong&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_canal_pingpong&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function _ at 0x73499c69c540&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_canal_pingpong&amp;gt;&amp;gt;, kwargs = {&amp;#x27;canal&amp;#x27;: &amp;#x27;pong&amp;#x27;, &amp;#x27;world1&amp;#x27;: WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x73499bd824...tream.FastStreamServiceContext object at 0x73499babf770&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x73499ba8e450&amp;gt;)])}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nworld1 = WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x73499bd82470&amp;gt;, pas=[PacServiceContext(...stream.FastStreamServiceContext object at 0x73499babf770&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x73499ba8e450&amp;gt;)]), canal = &amp;#x27;pong&amp;#x27;\n\n    @when(\n        parsers.parse(&amp;quot;j&amp;#x27;\u00e9coute le canal &amp;#x27;{canal}&amp;#x27;&amp;quot;),\n    )\n    def _(\n        world1: WorldContext,\n        canal: str,\n    ):\n        global handle_GLOBAL\n    \n        print(f&amp;quot;esb_sub {canal=}...&amp;quot;)\n        #raise NotImplementedError()\n&amp;gt;       broker = world1.pa.broker\n                 ^^^^^^^^^^^^^^^^\nE       AttributeError: &amp;#x27;PacServiceContext&amp;#x27; object has no attribute &amp;#x27;broker&amp;#x27;\n\nsrc/pac_bdd/esb.py:25: AttributeError\n\n----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:8442/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:9226 ...\n2026-01-15 10:27:00,231 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\nConnecting to NATS nats://localhost:9226 ...\n2026-01-15 10:27:00,231 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:27:00,231 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:27:00,231 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9226 ...\n2026-01-15 10:27:00,245 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:27:00,245 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9226 ...\n2026-01-15 10:27:00,250 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:27:00,251 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9226 ...\n2026-01-15 10:27:00,262 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-15 10:27:00,263 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:9226 ...\n2026-01-15 10:27:00,270 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:27:00,270 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:27:00,271 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:00,271 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:00,272 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:00,272 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:00,272 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:27:00,273 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:00,273 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:00,274 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:27:00,274 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:27:00,275 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:00,275 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:00,275 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:27:00,276 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:9226 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8442\n    server   Documentation at http://0.0.0.0:8442/docs\n \n             Logs:\n \n2026-01-15 10:27:00,450 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:27:00,451 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:27:00,452 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:27:00,453 INFO     - *                | 5f6963af-e - Received\n2026-01-15 10:27:00,456 INFO     - *                | 5f6963af-e - Processed\n_check_http_health http://localhost:8442/healthcheck\n      INFO   127.0.0.1:39336 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\nesb_sub canal=&amp;#x27;pong&amp;#x27;...\n\n----------------------------- Captured stderr call -----------------------------\n[36008] 2026/01/15 10:26:59.669248 [INF] Starting nats-server\n[36008] 2026/01/15 10:26:59.669339 [INF]   Version:  2.12.3\n[36008] 2026/01/15 10:26:59.669344 [INF]   Git:      [450a519]\n[36008] 2026/01/15 10:26:59.669349 [INF]   Name:     NBCMZZOQFVOLOL47C7DKFU3BU5UOGQCDVIM67JBZXX4THYINRALRRJUN\n[36008] 2026/01/15 10:26:59.669359 [INF]   ID:       NBCMZZOQFVOLOL47C7DKFU3BU5UOGQCDVIM67JBZXX4THYINRALRRJUN\n[36008] 2026/01/15 10:26:59.670356 [INF] Listening for client connections on 0.0.0.0:9226\n[36008] 2026/01/15 10:26:59.670901 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\nUsage: faststream run [OPTIONS] APP\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n2026-01-15 10:27:00,227 INFO     - FastStream app starting...\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:27:00,227 INFO     - FastStream app starting...\n2026-01-15 10:27:00,232 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:27:00,232 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:27:00,241 INFO     - FastStream app starting...\n2026-01-15 10:27:00,246 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:27:00,247 INFO     - FastStream app starting...\n2026-01-15 10:27:00,251 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:27:00,259 INFO     - FastStream app starting...\n2026-01-15 10:27:00,263 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:27:00,267 INFO     - FastStream app starting...\n2026-01-15 10:27:00,276 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [36025]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8442 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_j&amp;#x27;\u00e9coute le canal &amp;#x27;pong&amp;#x27;&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_j&amp;#x27;\u00e9coute le canal &amp;#x27;{canal}&amp;#x27;&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 9146 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:9146\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 9226 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:9226\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8442 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 8746 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:8746\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 8798 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:8798\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 9289 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:9289\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 8300 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:8300\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 8983 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:8983\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 9269 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:9269\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 8979 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:8979\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8442 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8442 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x73499bd7a450&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:27:00 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8442/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:8442\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [36025]\n2026-01-15 10:27:01,050 INFO     - FastStream app shutting down...\n2026-01-15 10:27:01,051 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:27:01,230 INFO     - FastStream app shutting down...\n2026-01-15 10:27:01,231 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:27:01,430 INFO     - FastStream app shutting down...\n2026-01-15 10:27:01,432 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:27:01,562 INFO     - FastStream app shutting down...\n2026-01-15 10:27:01,563 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:27:01,747 INFO     - FastStream app shutting down...\n2026-01-15 10:27:01,748 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:27:01,972 INFO     - FastStream app shutting down...\n2026-01-15 10:27:01,974 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_pa&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_pa&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_pa&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: Given &amp;quot;la PA #pa1&amp;quot;. Line 7 in scenario &amp;quot;2 PA&amp;quot; in the feature &amp;quot;/home/philippe/src/PA_Communautaire/docs/briques/07-routage/pa_multiple.feature&amp;quot;\nAll traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.\n&#34;}], &#34;test_scenario.py::test_peppol_req&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_peppol_req&#34;, &#34;duration&#34;: &#34;5 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_peppol_req&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;5 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\n[[&amp;#x27;id&amp;#x27;, &amp;#x27;smp&amp;#x27;], [&amp;#x27;e1&amp;#x27;, &amp;#x27;https://smp.pa-distante.fr&amp;#x27;], [&amp;#x27;e2&amp;#x27;, &amp;#x27;https://smp.autre-pa.fr&amp;#x27;]]\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_le service PEPPOL simul\u00e9 avec:&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_le service PEPPOL simul\u00e9 avec:&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8852 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:8852\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_md5&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_md5&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_md5&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function _ at 0x73499c6f2340&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_md5&amp;gt;&amp;gt;, kwargs = {&amp;#x27;peppol_context&amp;#x27;: PeppolContext(sml_zone=&amp;#x27;acc.edelivery.tech.ec.europa.eu&amp;#x27;, enterprise_id=None, siren=None, siret=None, result=&amp;#x27;b881aaeff8eeaed7190491ccdeaa42fc&amp;#x27;), &amp;#x27;result&amp;#x27;: &amp;#x27;6c2675d749449f2c8af1216fd866bb54&amp;#x27;}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\npeppol_context = PeppolContext(sml_zone=&amp;#x27;acc.edelivery.tech.ec.europa.eu&amp;#x27;, enterprise_id=None, siren=None, siret=None, result=&amp;#x27;b881aaeff8eeaed7190491ccdeaa42fc&amp;#x27;), result = &amp;#x27;6c2675d749449f2c8af1216fd866bb54&amp;#x27;\n\n    @then(parsers.parse(&amp;#x27;&amp;#x27;&amp;#x27;j&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27;&amp;#x27;&amp;#x27;))\n    def _(\n        peppol_context: PeppolContext,\n        result: str,\n    ):\n        &amp;quot;&amp;quot;&amp;quot;\u00e9tape g\u00e9n\u00e9rique pour tester tout r\u00e9sultat&amp;quot;&amp;quot;&amp;quot;\n        if peppol_context.result != result:\n            print(f&amp;quot;result: {peppol_context.result}&amp;quot;)\n            print(f&amp;quot;expecting: {result}&amp;quot;)\n&amp;gt;       assert peppol_context.result == result\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE       AssertionError\n\nsrc/pac_bdd/peppol.py:129: AssertionError\n\n----------------------------- Captured stdout call -----------------------------\nresult: b881aaeff8eeaed7190491ccdeaa42fc\nexpecting: 6c2675d749449f2c8af1216fd866bb54\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte md5 de &amp;quot;bonjour!&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte md5 de &amp;quot;{msg}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;, &amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;6c2675d749449f2c8af1216fd866bb54&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_identification_france&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_identification_france&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_identification_france&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\nxxxx 0002 0002\nxxxx 0009 0009\nxxxx 9957 9957\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_l\\&amp;#x27;identification par SIRET porte le code &amp;quot;0002&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_l\\&amp;#x27;identification par {facon} porte le code &amp;quot;{code}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_l\\&amp;#x27;identification par SIREN porte le code &amp;quot;0009&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_l\\&amp;#x27;identification par {facon} porte le code &amp;quot;{code}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_l\\&amp;#x27;identification par TVA_FR porte le code &amp;quot;9957&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_l\\&amp;#x27;identification par {facon} porte le code &amp;quot;{code}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_empreinte_participant&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_empreinte_participant&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_empreinte_participant&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte SIREN &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;3ddb2999105b666703fc700e14885016&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte SIRET &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;6dbdf4f29451b37456ca48b550bdbaee&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;empreinte TVA_FR &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;empreinte {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;d0d6bafc0317e3e8baa9504a9a022f9c&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_h\u00f4te_sml&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_h\u00f4te_sml&#34;, &#34;duration&#34;: &#34;3 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_h\u00f4te_sml&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;3 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_la racine SML &amp;quot;ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_la racine SML &amp;quot;{zone}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIREN &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-3ddb2999105b666703fc700e14885016.iso6523-actorid-upis.ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIRET &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-6dbdf4f29451b37456ca48b550bdbaee.iso6523-actorid-upis.ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour TVA_FR &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-d0d6bafc0317e3e8baa9504a9a022f9c.iso6523-actorid-upis.ma.racine.local&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_given_la racine SML &amp;quot;acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_given_la racine SML &amp;quot;{zone}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIREN &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-3ddb2999105b666703fc700e14885016.iso6523-actorid-upis.acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour SIRET &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-6dbdf4f29451b37456ca48b550bdbaee.iso6523-actorid-upis.acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je calcule l\\&amp;#x27;h\u00f4te SML pour TVA_FR &amp;quot;222222222&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je calcule l\\&amp;#x27;h\u00f4te SML pour {facon} &amp;quot;{id}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_then_j\\&amp;#x27;obtiens &amp;quot;B-d0d6bafc0317e3e8baa9504a9a022f9c.iso6523-actorid-upis.acc.edelivery.tech.ec.europa.eu&amp;quot;&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_then_j\\&amp;#x27;obtiens &amp;quot;{result}&amp;quot;&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_rejet_dolibarr&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_rejet_dolibarr&#34;, &#34;duration&#34;: &#34;1 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_rejet_dolibarr&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;1 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function compliance_rule_set at 0x73499c508ea0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_rejet_dolibarr&amp;gt;&amp;gt;, kwargs = {}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @when(&amp;quot;je d\u00e9finis un contr\u00f4le de conformit\u00e9 m\u00e9tier fournisseur&amp;quot;)\n    def compliance_rule_set():\n&amp;gt;       raise NotImplementedError()\nE       NotImplementedError\n\nsrc/pac_bdd/tobeimplemented.py:45: NotImplementedError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je d\u00e9finis un contr\u00f4le de conformit\u00e9 m\u00e9tier fournisseur&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je d\u00e9finis un contr\u00f4le de conformit\u00e9 m\u00e9tier fournisseur&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}], &#34;test_scenario.py::test_cycle_basique&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_cycle_basique&#34;, &#34;duration&#34;: &#34;00:00:03&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_cycle_basique&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:03&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function _ at 0x73499c69cae0&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_cycle_basique&amp;gt;&amp;gt;, kwargs = {&amp;#x27;canal&amp;#x27;: &amp;#x27;controle-formats-IN&amp;#x27;, &amp;#x27;msg&amp;#x27;: &amp;#x27;hello&amp;#x27;, &amp;#x27;world1&amp;#x27;: WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServic...tream.FastStreamServiceContext object at 0x73499bbbe2e0&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x73499ba8cf50&amp;gt;)])}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nworld1 = WorldContext(peppol=&amp;lt;pac0.shared.test.service.dns.DNSServiceContext object at 0x73499baaa150&amp;gt;, pas=[PacServiceContext(...stream.FastStreamServiceContext object at 0x73499bbbe2e0&amp;gt;, client_async=&amp;lt;httpx.AsyncClient object at 0x73499ba8cf50&amp;gt;)]), msg = &amp;#x27;hello&amp;#x27;, canal = &amp;#x27;controle-formats-IN&amp;#x27;\n\n    @then(parsers.parse(&amp;quot;&amp;quot;&amp;quot;j&amp;#x27;obtiens le message &amp;#x27;{msg}&amp;#x27; sur le canal &amp;#x27;{canal}&amp;#x27;&amp;quot;&amp;quot;&amp;quot;))\n    def _(\n        world1: WorldContext,\n        msg: str,\n        canal: str,\n    ):\n        traces = []\n        with world1.pa1.api_gateway.get_client() as client:\n            response = client.get(&amp;quot;/trace&amp;quot;)\n            assert response.status_code == 200\n            traces = response.json()\n    \n        for trace in traces:\n            print(trace)\n            if trace[&amp;quot;subject&amp;quot;] == canal and trace[&amp;quot;body&amp;quot;] == msg:\n                return\n        else:\n&amp;gt;           raise Exception(&amp;quot;message not found !&amp;quot;)\nE           Exception: message not found !\n\nsrc/pac_bdd/esb.py:78: Exception\n\n----------------------------- Captured stdout call -----------------------------\n_check_http_health http://localhost:8947/healthcheck\ncccccc All connection attempts failed\nConnecting to NATS nats://localhost:8348 ...\n2026-01-15 10:27:02,711 INFO     - q | controle-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:27:02,712 INFO     -   | healthcheck         |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8348 ...\n2026-01-15 10:27:02,719 INFO     - q | validation-metier-IN |            - `Process` waiting for messages\n2026-01-15 10:27:02,720 INFO     -   | healthcheck          |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8348 ...\n2026-01-15 10:27:02,732 INFO     - q | conversion-formats-IN |            - `Process` waiting for messages\n2026-01-15 10:27:02,733 INFO     -   | healthcheck           |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8348 ...\n2026-01-15 10:27:02,742 INFO     - q | routage-IN  |            - `Process` waiting for messages\n2026-01-15 10:27:02,743 INFO     -   | healthcheck |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8348 ...\n2026-01-15 10:27:02,757 INFO     - q | transmission-fiscale-IN |            - `Process` waiting for messages\n2026-01-15 10:27:02,758 INFO     -   | healthcheck             |            - `HealthcheckSub` waiting for messages\nConnecting to NATS nats://localhost:8348 ...\n2026-01-15 10:27:02,770 INFO     - q | routage-OUT              |            - `Process07To08` waiting for messages\n2026-01-15 10:27:02,771 INFO     - q | api-gateway-OUT          |            - `Process01To03` waiting for messages\n2026-01-15 10:27:02,771 INFO     - q | routage-ERR              |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:02,771 INFO     - q | annuaire-local-ERR       |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:02,772 INFO     - q | validation-metier-ERR    |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:02,772 INFO     - q | esb-central-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:02,772 INFO     - q | annuaire-local-OUT       |            - `Process06To07` waiting for messages\n2026-01-15 10:27:02,773 INFO     - q | transmission-fiscale-ERR |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:02,773 INFO     - q | conversion-formats-ERR   |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:02,774 INFO     - q | conversion-formats-OUT   |            - `Process05To06` waiting for messages\n2026-01-15 10:27:02,774 INFO     - q | validation-metier-OUT    |            - `Process04To05` waiting for messages\n2026-01-15 10:27:02,774 INFO     - q | api-gateway-ERR          |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:02,775 INFO     - q | controle-formats-ERR     |            - `ProcessErr` waiting for messages\n2026-01-15 10:27:02,775 INFO     - q | controle-formats-OUT     |            - `Process03To04` waiting for messages\n2026-01-15 10:27:02,775 INFO     -   | healthcheck              |            - `HealthcheckSub` waiting for messages\n\n   FastAPI   Starting production server \ud83d\ude80\n \n             Searching for package file structure from directories with         \n             __init__.py files                                                  \nConnecting to NATS nats://localhost:8348 ...\n             Importing from                                                     \n             /home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/\n             api_gateway                                                        \n \n    module   \ud83d\udc0d main.py\n \n      code   Importing the FastAPI app object from the module with the following\n             code:                                                              \n \n             from main import app\n \n       app   Using import string: main:app\n \n    server   Server started at http://0.0.0.0:8947\n    server   Documentation at http://0.0.0.0:8947/docs\n \n             Logs:\n \n2026-01-15 10:27:02,941 INFO     - healthcheck      |            - `HealthcheckSub` waiting for messages\n2026-01-15 10:27:02,942 INFO     - *                |            - `AllSub` waiting for messages\n2026-01-15 10:27:02,943 INFO     - healthcheck_resp |            - `HealthcheckRespSub` waiting for messages\n2026-01-15 10:27:02,944 INFO     - *                | 0e227cad-c - Received\n2026-01-15 10:27:02,947 INFO     - *                | 0e227cad-c - Processed\n_check_http_health http://localhost:8947/healthcheck\n      INFO   127.0.0.1:38734 - &amp;quot;GET /healthcheck HTTP/1.1&amp;quot; 200\n      INFO   127.0.0.1:38740 - &amp;quot;POST /publish HTTP/1.1&amp;quot; 200\n2026-01-15 10:27:03,329 INFO     - *                | fefd6eaa-a - Received\n2026-01-15 10:27:03,330 INFO     - *                | fefd6eaa-a - Processed\n      INFO   127.0.0.1:38752 - &amp;quot;GET /trace HTTP/1.1&amp;quot; 200\n{&amp;#x27;body&amp;#x27;: &amp;#x27;Startup!!!&amp;#x27;, &amp;#x27;content_type&amp;#x27;: &amp;#x27;text/plain&amp;#x27;, &amp;#x27;message_id&amp;#x27;: &amp;#x27;0e227cad-c6d7-4d5d-9fd5-7ea23ee117c6&amp;#x27;, &amp;#x27;correlation_id&amp;#x27;: &amp;#x27;0e227cad-c6d7-4d5d-9fd5-7ea23ee117c6&amp;#x27;, &amp;#x27;path&amp;#x27;: {}, &amp;#x27;committed&amp;#x27;: None, &amp;#x27;subject&amp;#x27;: &amp;#x27;test&amp;#x27;, &amp;#x27;reply&amp;#x27;: &amp;#x27;&amp;#x27;}\n{&amp;#x27;body&amp;#x27;: &amp;#x27;publishing ...&amp;#x27;, &amp;#x27;content_type&amp;#x27;: &amp;#x27;text/plain&amp;#x27;, &amp;#x27;message_id&amp;#x27;: &amp;#x27;fefd6eaa-acb3-4429-9ea4-a9ff72ce6cbc&amp;#x27;, &amp;#x27;correlation_id&amp;#x27;: &amp;#x27;fefd6eaa-acb3-4429-9ea4-a9ff72ce6cbc&amp;#x27;, &amp;#x27;path&amp;#x27;: {}, &amp;#x27;committed&amp;#x27;: None, &amp;#x27;subject&amp;#x27;: &amp;#x27;xxx&amp;#x27;, &amp;#x27;reply&amp;#x27;: &amp;#x27;&amp;#x27;}\n\n----------------------------- Captured stderr call -----------------------------\n[36094] 2026/01/15 10:27:02.179841 [INF] Starting nats-server\n[36094] 2026/01/15 10:27:02.179929 [INF]   Version:  2.12.3\n[36094] 2026/01/15 10:27:02.179935 [INF]   Git:      [450a519]\n[36094] 2026/01/15 10:27:02.179939 [INF]   Name:     NAXBH4NFNAJGF2O7H6AR2PE6ST77LJ2DEBTQTUSPN4X52M74RFGXPYAL\n[36094] 2026/01/15 10:27:02.179949 [INF]   ID:       NAXBH4NFNAJGF2O7H6AR2PE6ST77LJ2DEBTQTUSPN4X52M74RFGXPYAL\n[36094] 2026/01/15 10:27:02.180552 [INF] Listening for client connections on 0.0.0.0:8348\n[36094] 2026/01/15 10:27:02.180997 [INF] Server is ready\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\nwarning: `VIRTUAL_ENV=/home/philippe/src/PA_Communautaire/packages/pac-bdd/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead\n[Errno 2] No such file or directory: &amp;#x27;/home/philippe/src/PA_Communautaire/packages/pac0/src/pac0/service/annuaire_local/main.py&amp;#x27;\n2026-01-15 10:27:02,707 INFO     - FastStream app starting...\n2026-01-15 10:27:02,712 INFO     - FastStream app started successfully! To exit, press CTRL+C\nUsage: faststream run [OPTIONS] APP\n2026-01-15 10:27:02,716 INFO     - FastStream app starting...\nTry &amp;#x27;faststream run --help&amp;#x27; for help.\n\u256d\u2500 Error \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Invalid value: Please, input module like [python_file:docs_object] or        \u2502\n\u2502 [module:attribute]                                                           \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n2026-01-15 10:27:02,720 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:27:02,729 INFO     - FastStream app starting...\n2026-01-15 10:27:02,733 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:27:02,738 INFO     - FastStream app starting...\n2026-01-15 10:27:02,743 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:27:02,753 INFO     - FastStream app starting...\n2026-01-15 10:27:02,758 INFO     - FastStream app started successfully! To exit, press CTRL+C\n2026-01-15 10:27:02,766 INFO     - FastStream app starting...\n2026-01-15 10:27:02,775 INFO     - FastStream app started successfully! To exit, press CTRL+C\n      INFO   Started server process [36109]\n      INFO   Waiting for application startup.\n      INFO   Application startup complete.\n      INFO   Uvicorn running on http://0.0.0.0:8947 (Press CTRL+C to quit)\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_when_je publie le message &amp;#x27;hello&amp;#x27; sur le canal &amp;#x27;api-gateway-OUT&amp;#x27;&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_when_je publie le message &amp;#x27;{msg}&amp;#x27; sur le canal &amp;#x27;{canal}&amp;#x27;&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     pac0.shared.test.service.base:base.py:136 Starting service peppol on port 8916 : uv run src/pac0/service/peppol_dns_fake/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready peppol ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  peppol started on localhost:8916\nINFO     pac0.shared.test.world:world.py:83 WorldContext: enter context ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service esb_central on port 8348 : nats-server --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready esb_central ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  esb_central started on localhost:8348\nINFO     pac0.shared.test.service.base:base.py:136 Starting service api_gateway on port 8947 : uv run fastapi run src/pac0/service/api_gateway/main.py\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nINFO     pac0.shared.test.service.base:base.py:136 Starting service controle_formats on port 9225 : uv run faststream run src/pac0/service/controle_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready controle_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  controle_formats started on localhost:9225\nINFO     pac0.shared.test.service.base:base.py:136 Starting service validation_metier on port 8672 : uv run faststream run src/pac0/service/validation_metier/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready validation_metier ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  validation_metier started on localhost:8672\nINFO     pac0.shared.test.service.base:base.py:136 Starting service conversion_formats on port 8548 : uv run faststream run src/pac0/service/conversion_formats/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready conversion_formats ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  conversion_formats started on localhost:8548\nINFO     pac0.shared.test.service.base:base.py:136 Starting service annuaire_local on port 8611 : uv run faststream run src/pac0/service/annuaire_local/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready annuaire_local ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  annuaire_local started on localhost:8611\nINFO     pac0.shared.test.service.base:base.py:136 Starting service routage on port 9016 : uv run faststream run src/pac0/service/routage/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready routage ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  routage started on localhost:9016\nINFO     pac0.shared.test.service.base:base.py:136 Starting service transmission_fiscale on port 8932 : uv run faststream run src/pac0/service/transmission_fiscale/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready transmission_fiscale ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  transmission_fiscale started on localhost:8932\nINFO     pac0.shared.test.service.base:base.py:136 Starting service gestion_cycle_vie on port 9122 : uv run faststream run src/pac0/service/gestion_cycle_vie/main:app --port={PORT}\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready gestion_cycle_vie ...\nINFO     pac0.shared.test.service.base:base.py:163 Service  gestion_cycle_vie started on localhost:9122\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8947 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.failed exception=ConnectError(OSError(&amp;#x27;All connection attempts failed&amp;#x27;))\nDEBUG    pac0.shared.test.service.base:base.py:192 wait_for_ready api_gateway ...\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8947 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:87 connect_tcp.complete return_value=&amp;lt;httpcore._backends.anyio.AnyIOStream object at 0x73499baaa650&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:27:02 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;28&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1740 HTTP Request: GET http://localhost:8947/healthcheck &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:87 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:87 response_closed.started\nDEBUG    httpcore.http11:_trace.py:87 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:87 close.started\nDEBUG    httpcore.connection:_trace.py:87 close.complete\nINFO     pac0.shared.test.service.base:base.py:163 Service  api_gateway started on localhost:8947\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8947 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x73499baa9b50&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:27:02 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;4&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8947/publish &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;POST&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;quot;pytestbdd_stepimpl_then_j&amp;#x27;obtiens le message &amp;#x27;hello&amp;#x27; sur le canal &amp;#x27;controle-formats-IN&amp;#x27;&amp;quot;: [&amp;lt;FixtureDef argname=&amp;quot;pytestbdd_stepdef_then_j&amp;#x27;obtiens le message &amp;#x27;{msg}&amp;#x27; sur le canal &amp;#x27;{canal}&amp;#x27;&amp;quot; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.started host=&amp;#x27;localhost&amp;#x27; port=8947 local_address=None timeout=5.0 socket_options=None\nDEBUG    httpcore.connection:_trace.py:47 connect_tcp.complete return_value=&amp;lt;httpcore._backends.sync.SyncStream object at 0x73499bb26950&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_headers.complete\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 send_request_body.complete\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b&amp;#x27;HTTP/1.1&amp;#x27;, 200, b&amp;#x27;OK&amp;#x27;, [(b&amp;#x27;date&amp;#x27;, b&amp;#x27;Thu, 15 Jan 2026 09:27:02 GMT&amp;#x27;), (b&amp;#x27;server&amp;#x27;, b&amp;#x27;uvicorn&amp;#x27;), (b&amp;#x27;content-length&amp;#x27;, b&amp;#x27;430&amp;#x27;), (b&amp;#x27;content-type&amp;#x27;, b&amp;#x27;application/json&amp;#x27;)])\nINFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8947/trace &amp;quot;HTTP/1.1 200 OK&amp;quot;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.started request=&amp;lt;Request [b&amp;#x27;GET&amp;#x27;]&amp;gt;\nDEBUG    httpcore.http11:_trace.py:47 receive_response_body.complete\nDEBUG    httpcore.http11:_trace.py:47 response_closed.started\nDEBUG    httpcore.http11:_trace.py:47 response_closed.complete\nDEBUG    httpcore.connection:_trace.py:47 close.started\nDEBUG    httpcore.connection:_trace.py:47 close.complete\n\n--------------------------- Captured stderr teardown ---------------------------\n      INFO   Shutting down\n      INFO   Waiting for application shutdown.\n      INFO   Application shutdown complete.\n      INFO   Finished server process [36109]\n2026-01-15 10:27:03,610 INFO     - FastStream app shutting down...\n2026-01-15 10:27:03,612 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:27:03,819 INFO     - FastStream app shutting down...\n2026-01-15 10:27:03,821 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:27:04,033 INFO     - FastStream app shutting down...\n2026-01-15 10:27:04,035 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:27:04,244 INFO     - FastStream app shutting down...\n2026-01-15 10:27:04,245 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:27:04,459 INFO     - FastStream app shutting down...\n2026-01-15 10:27:04,460 INFO     - FastStream app shut down gracefully.\n2026-01-15 10:27:04,675 INFO     - FastStream app shutting down...\n2026-01-15 10:27:04,677 INFO     - FastStream app shut down gracefully.\n\n---------------------------- Captured log teardown -----------------------------\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.service.base:base.py:175 Stopping service...\nINFO     pac0.shared.test.world:world.py:91 WorldContext: exit context ...&#34;}], &#34;test_scenario.py::test_facture_rejet\u00e9e&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_scenario.py::test_facture_rejet\u00e9e&#34;, &#34;duration&#34;: &#34;2 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_scenario.py::test_facture_rejet\u00e9e&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;2 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;fixturefunc = &amp;lt;function submit_invoice_simple at 0x73499c508540&amp;gt;, request = &amp;lt;FixtureRequest for &amp;lt;Function test_facture_rejet\u00e9e&amp;gt;&amp;gt;, kwargs = {}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -&amp;gt; FixtureValue:\n        if inspect.isgeneratorfunction(fixturefunc):\n            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f&amp;quot;{request.fixturename} did not yield a value&amp;quot;) from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n&amp;gt;           fixture_result = fixturefunc(**kwargs)\n                             ^^^^^^^^^^^^^^^^^^^^^\n\n.venv/lib/python3.13/site-packages/_pytest/fixtures.py:930: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n    @when(&amp;quot;je d\u00e9pose une facture&amp;quot;)\n    def submit_invoice_simple():\n        # POST /\n&amp;gt;       raise NotImplementedError()\nE       NotImplementedError\n\nsrc/pac_bdd/tobeimplemented.py:17: NotImplementedError\n\n------------------------------ Captured log call -------------------------------\nDEBUG    pytest_bdd.scenario:scenario.py:150 Adding providers for fixture &amp;#x27;pytestbdd_stepimpl_when_je d\u00e9pose une facture&amp;#x27;: [&amp;lt;FixtureDef argname=&amp;#x27;pytestbdd_stepdef_when_je d\u00e9pose une facture&amp;#x27; scope=&amp;#x27;function&amp;#x27; baseid=&amp;#x27;test_scenario.py&amp;#x27;&amp;gt;]\n\n&#34;}]}, &#34;renderCollapsed&#34;: [&#34;passed&#34;], &#34;initialSort&#34;: &#34;result&#34;, &#34;title&#34;: &#34;report.html&#34;}"></div>
    <script>
      (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
const { getCollapsedCategory, setCollapsedIds } = require('./storage.js')

class DataManager {
    setManager(data) {
        const collapsedCategories = [...getCollapsedCategory(data.renderCollapsed)]
        const collapsedIds = []
        const tests = Object.values(data.tests).flat().map((test, index) => {
            const collapsed = collapsedCategories.includes(test.result.toLowerCase())
            const id = `test_${index}`
            if (collapsed) {
                collapsedIds.push(id)
            }
            return {
                ...test,
                id,
                collapsed,
            }
        })
        const dataBlob = { ...data, tests }
        this.data = { ...dataBlob }
        this.renderData = { ...dataBlob }
        setCollapsedIds(collapsedIds)
    }

    get allData() {
        return { ...this.data }
    }

    resetRender() {
        this.renderData = { ...this.data }
    }

    setRender(data) {
        this.renderData.tests = [...data]
    }

    toggleCollapsedItem(id) {
        this.renderData.tests = this.renderData.tests.map((test) =>
            test.id === id ? { ...test, collapsed: !test.collapsed } : test,
        )
    }

    set allCollapsed(collapsed) {
        this.renderData = { ...this.renderData, tests: [...this.renderData.tests.map((test) => (
            { ...test, collapsed }
        ))] }
    }

    get testSubset() {
        return [...this.renderData.tests]
    }

    get environment() {
        return this.renderData.environment
    }

    get initialSort() {
        return this.data.initialSort
    }
}

module.exports = {
    manager: new DataManager(),
}

},{"./storage.js":8}],2:[function(require,module,exports){
const mediaViewer = require('./mediaviewer.js')
const templateEnvRow = document.getElementById('template_environment_row')
const templateResult = document.getElementById('template_results-table__tbody')

function htmlToElements(html) {
    const temp = document.createElement('template')
    temp.innerHTML = html
    return temp.content.childNodes
}

const find = (selector, elem) => {
    if (!elem) {
        elem = document
    }
    return elem.querySelector(selector)
}

const findAll = (selector, elem) => {
    if (!elem) {
        elem = document
    }
    return [...elem.querySelectorAll(selector)]
}

const dom = {
    getStaticRow: (key, value) => {
        const envRow = templateEnvRow.content.cloneNode(true)
        const isObj = typeof value === 'object' && value !== null
        const values = isObj ? Object.keys(value).map((k) => `${k}: ${value[k]}`) : null

        const valuesElement = htmlToElements(
            values ? `<ul>${values.map((val) => `<li>${val}</li>`).join('')}<ul>` : `<div>${value}</div>`)[0]
        const td = findAll('td', envRow)
        td[0].textContent = key
        td[1].appendChild(valuesElement)

        return envRow
    },
    getResultTBody: ({ testId, id, log, extras, resultsTableRow, tableHtml, result, collapsed }) => {
        const resultBody = templateResult.content.cloneNode(true)
        resultBody.querySelector('tbody').classList.add(result.toLowerCase())
        resultBody.querySelector('tbody').id = testId
        resultBody.querySelector('.collapsible').dataset.id = id

        resultsTableRow.forEach((html) => {
            const t = document.createElement('template')
            t.innerHTML = html
            resultBody.querySelector('.collapsible').appendChild(t.content)
        })

        if (log) {
            // Wrap lines starting with "E" with span.error to color those lines red
            const wrappedLog = log.replace(/^E.*$/gm, (match) => `<span class="error">${match}</span>`)
            resultBody.querySelector('.log').innerHTML = wrappedLog
        } else {
            resultBody.querySelector('.log').remove()
        }

        if (collapsed) {
            resultBody.querySelector('.collapsible > td')?.classList.add('collapsed')
            resultBody.querySelector('.extras-row').classList.add('hidden')
        } else {
            resultBody.querySelector('.collapsible > td')?.classList.remove('collapsed')
        }

        const media = []
        extras?.forEach(({ name, format_type, content }) => {
            if (['image', 'video'].includes(format_type)) {
                media.push({ path: content, name, format_type })
            }

            if (format_type === 'html') {
                resultBody.querySelector('.extraHTML').insertAdjacentHTML('beforeend', `<div>${content}</div>`)
            }
        })
        mediaViewer.setup(resultBody, media)

        // Add custom html from the pytest_html_results_table_html hook
        tableHtml?.forEach((item) => {
            resultBody.querySelector('td[class="extra"]').insertAdjacentHTML('beforeend', item)
        })

        return resultBody
    },
}

module.exports = {
    dom,
    htmlToElements,
    find,
    findAll,
}

},{"./mediaviewer.js":6}],3:[function(require,module,exports){
const { manager } = require('./datamanager.js')
const { doSort } = require('./sort.js')
const storageModule = require('./storage.js')

const getFilteredSubSet = (filter) =>
    manager.allData.tests.filter(({ result }) => filter.includes(result.toLowerCase()))

const doInitFilter = () => {
    const currentFilter = storageModule.getVisible()
    const filteredSubset = getFilteredSubSet(currentFilter)
    manager.setRender(filteredSubset)
}

const doFilter = (type, show) => {
    if (show) {
        storageModule.showCategory(type)
    } else {
        storageModule.hideCategory(type)
    }

    const currentFilter = storageModule.getVisible()
    const filteredSubset = getFilteredSubSet(currentFilter)
    manager.setRender(filteredSubset)

    const sortColumn = storageModule.getSort()
    doSort(sortColumn, true)
}

module.exports = {
    doFilter,
    doInitFilter,
}

},{"./datamanager.js":1,"./sort.js":7,"./storage.js":8}],4:[function(require,module,exports){
const { redraw, bindEvents, renderStatic } = require('./main.js')
const { doInitFilter } = require('./filter.js')
const { doInitSort } = require('./sort.js')
const { manager } = require('./datamanager.js')
const data = JSON.parse(document.getElementById('data-container').dataset.jsonblob)

function init() {
    manager.setManager(data)
    doInitFilter()
    doInitSort()
    renderStatic()
    redraw()
    bindEvents()
}

init()

},{"./datamanager.js":1,"./filter.js":3,"./main.js":5,"./sort.js":7}],5:[function(require,module,exports){
const { dom, find, findAll } = require('./dom.js')
const { manager } = require('./datamanager.js')
const { doSort } = require('./sort.js')
const { doFilter } = require('./filter.js')
const {
    getVisible,
    getCollapsedIds,
    setCollapsedIds,
    getSort,
    getSortDirection,
    possibleFilters,
} = require('./storage.js')

const removeChildren = (node) => {
    while (node.firstChild) {
        node.removeChild(node.firstChild)
    }
}

const renderStatic = () => {
    const renderEnvironmentTable = () => {
        const environment = manager.environment
        const rows = Object.keys(environment).map((key) => dom.getStaticRow(key, environment[key]))
        const table = document.getElementById('environment')
        removeChildren(table)
        rows.forEach((row) => table.appendChild(row))
    }
    renderEnvironmentTable()
}

const addItemToggleListener = (elem) => {
    elem.addEventListener('click', ({ target }) => {
        const id = target.parentElement.dataset.id
        manager.toggleCollapsedItem(id)

        const collapsedIds = getCollapsedIds()
        if (collapsedIds.includes(id)) {
            const updated = collapsedIds.filter((item) => item !== id)
            setCollapsedIds(updated)
        } else {
            collapsedIds.push(id)
            setCollapsedIds(collapsedIds)
        }
        redraw()
    })
}

const renderContent = (tests) => {
    const sortAttr = getSort(manager.initialSort)
    const sortAsc = JSON.parse(getSortDirection())
    const rows = tests.map(dom.getResultTBody)
    const table = document.getElementById('results-table')
    const tableHeader = document.getElementById('results-table-head')

    const newTable = document.createElement('table')
    newTable.id = 'results-table'

    // remove all sorting classes and set the relevant
    findAll('.sortable', tableHeader).forEach((elem) => elem.classList.remove('asc', 'desc'))
    tableHeader.querySelector(`.sortable[data-column-type="${sortAttr}"]`)?.classList.add(sortAsc ? 'desc' : 'asc')
    newTable.appendChild(tableHeader)

    if (!rows.length) {
        const emptyTable = document.getElementById('template_results-table__body--empty').content.cloneNode(true)
        newTable.appendChild(emptyTable)
    } else {
        rows.forEach((row) => {
            if (!!row) {
                findAll('.collapsible td:not(.col-links', row).forEach(addItemToggleListener)
                find('.logexpander', row).addEventListener('click',
                    (evt) => evt.target.parentNode.classList.toggle('expanded'),
                )
                newTable.appendChild(row)
            }
        })
    }

    table.replaceWith(newTable)
}

const renderDerived = () => {
    const currentFilter = getVisible()
    possibleFilters.forEach((result) => {
        const input = document.querySelector(`input[data-test-result="${result}"]`)
        input.checked = currentFilter.includes(result)
    })
}

const bindEvents = () => {
    const filterColumn = (evt) => {
        const { target: element } = evt
        const { testResult } = element.dataset

        doFilter(testResult, element.checked)
        const collapsedIds = getCollapsedIds()
        const updated = manager.renderData.tests.map((test) => {
            return {
                ...test,
                collapsed: collapsedIds.includes(test.id),
            }
        })
        manager.setRender(updated)
        redraw()
    }

    const header = document.getElementById('environment-header')
    header.addEventListener('click', () => {
        const table = document.getElementById('environment')
        table.classList.toggle('hidden')
        header.classList.toggle('collapsed')
    })

    findAll('input[name="filter_checkbox"]').forEach((elem) => {
        elem.addEventListener('click', filterColumn)
    })

    findAll('.sortable').forEach((elem) => {
        elem.addEventListener('click', (evt) => {
            const { target: element } = evt
            const { columnType } = element.dataset
            doSort(columnType)
            redraw()
        })
    })

    document.getElementById('show_all_details').addEventListener('click', () => {
        manager.allCollapsed = false
        setCollapsedIds([])
        redraw()
    })
    document.getElementById('hide_all_details').addEventListener('click', () => {
        manager.allCollapsed = true
        const allIds = manager.renderData.tests.map((test) => test.id)
        setCollapsedIds(allIds)
        redraw()
    })
}

const redraw = () => {
    const { testSubset } = manager

    renderContent(testSubset)
    renderDerived()
}

module.exports = {
    redraw,
    bindEvents,
    renderStatic,
}

},{"./datamanager.js":1,"./dom.js":2,"./filter.js":3,"./sort.js":7,"./storage.js":8}],6:[function(require,module,exports){
class MediaViewer {
    constructor(assets) {
        this.assets = assets
        this.index = 0
    }

    nextActive() {
        this.index = this.index === this.assets.length - 1 ? 0 : this.index + 1
        return [this.activeFile, this.index]
    }

    prevActive() {
        this.index = this.index === 0 ? this.assets.length - 1 : this.index -1
        return [this.activeFile, this.index]
    }

    get currentIndex() {
        return this.index
    }

    get activeFile() {
        return this.assets[this.index]
    }
}


const setup = (resultBody, assets) => {
    if (!assets.length) {
        resultBody.querySelector('.media').classList.add('hidden')
        return
    }

    const mediaViewer = new MediaViewer(assets)
    const container = resultBody.querySelector('.media-container')
    const leftArrow = resultBody.querySelector('.media-container__nav--left')
    const rightArrow = resultBody.querySelector('.media-container__nav--right')
    const mediaName = resultBody.querySelector('.media__name')
    const counter = resultBody.querySelector('.media__counter')
    const imageEl = resultBody.querySelector('img')
    const sourceEl = resultBody.querySelector('source')
    const videoEl = resultBody.querySelector('video')

    const setImg = (media, index) => {
        if (media?.format_type === 'image') {
            imageEl.src = media.path

            imageEl.classList.remove('hidden')
            videoEl.classList.add('hidden')
        } else if (media?.format_type === 'video') {
            sourceEl.src = media.path

            videoEl.classList.remove('hidden')
            imageEl.classList.add('hidden')
        }

        mediaName.innerText = media?.name
        counter.innerText = `${index + 1} / ${assets.length}`
    }
    setImg(mediaViewer.activeFile, mediaViewer.currentIndex)

    const moveLeft = () => {
        const [media, index] = mediaViewer.prevActive()
        setImg(media, index)
    }
    const doRight = () => {
        const [media, index] = mediaViewer.nextActive()
        setImg(media, index)
    }
    const openImg = () => {
        window.open(mediaViewer.activeFile.path, '_blank')
    }
    if (assets.length === 1) {
        container.classList.add('media-container--fullscreen')
    } else {
        leftArrow.addEventListener('click', moveLeft)
        rightArrow.addEventListener('click', doRight)
    }
    imageEl.addEventListener('click', openImg)
}

module.exports = {
    setup,
}

},{}],7:[function(require,module,exports){
const { manager } = require('./datamanager.js')
const storageModule = require('./storage.js')

const genericSort = (list, key, ascending, customOrder) => {
    let sorted
    if (customOrder) {
        sorted = list.sort((a, b) => {
            const aValue = a.result.toLowerCase()
            const bValue = b.result.toLowerCase()

            const aIndex = customOrder.findIndex((item) => item.toLowerCase() === aValue)
            const bIndex = customOrder.findIndex((item) => item.toLowerCase() === bValue)

            // Compare the indices to determine the sort order
            return aIndex - bIndex
        })
    } else {
        sorted = list.sort((a, b) => a[key] === b[key] ? 0 : a[key] > b[key] ? 1 : -1)
    }

    if (ascending) {
        sorted.reverse()
    }
    return sorted
}

const durationSort = (list, ascending) => {
    const parseDuration = (duration) => {
        if (duration.includes(':')) {
            // If it's in the format "HH:mm:ss"
            const [hours, minutes, seconds] = duration.split(':').map(Number)
            return (hours * 3600 + minutes * 60 + seconds) * 1000
        } else {
            // If it's in the format "nnn ms"
            return parseInt(duration)
        }
    }
    const sorted = list.sort((a, b) => parseDuration(a['duration']) - parseDuration(b['duration']))
    if (ascending) {
        sorted.reverse()
    }
    return sorted
}

const doInitSort = () => {
    const type = storageModule.getSort(manager.initialSort)
    const ascending = storageModule.getSortDirection()
    const list = manager.testSubset
    const initialOrder = ['Error', 'Failed', 'Rerun', 'XFailed', 'XPassed', 'Skipped', 'Passed']

    storageModule.setSort(type)
    storageModule.setSortDirection(ascending)

    if (type?.toLowerCase() === 'original') {
        manager.setRender(list)
    } else {
        let sortedList
        switch (type) {
        case 'duration':
            sortedList = durationSort(list, ascending)
            break
        case 'result':
            sortedList = genericSort(list, type, ascending, initialOrder)
            break
        default:
            sortedList = genericSort(list, type, ascending)
            break
        }
        manager.setRender(sortedList)
    }
}

const doSort = (type, skipDirection) => {
    const newSortType = storageModule.getSort(manager.initialSort) !== type
    const currentAsc = storageModule.getSortDirection()
    let ascending
    if (skipDirection) {
        ascending = currentAsc
    } else {
        ascending = newSortType ? false : !currentAsc
    }
    storageModule.setSort(type)
    storageModule.setSortDirection(ascending)

    const list = manager.testSubset
    const sortedList = type === 'duration' ? durationSort(list, ascending) : genericSort(list, type, ascending)
    manager.setRender(sortedList)
}

module.exports = {
    doInitSort,
    doSort,
}

},{"./datamanager.js":1,"./storage.js":8}],8:[function(require,module,exports){
const possibleFilters = [
    'passed',
    'skipped',
    'failed',
    'error',
    'xfailed',
    'xpassed',
    'rerun',
]

const getVisible = () => {
    const url = new URL(window.location.href)
    const settings = new URLSearchParams(url.search).get('visible')
    const lower = (item) => {
        const lowerItem = item.toLowerCase()
        if (possibleFilters.includes(lowerItem)) {
            return lowerItem
        }
        return null
    }
    return settings === null ?
        possibleFilters :
        [...new Set(settings?.split(',').map(lower).filter((item) => item))]
}

const hideCategory = (categoryToHide) => {
    const url = new URL(window.location.href)
    const visibleParams = new URLSearchParams(url.search).get('visible')
    const currentVisible = visibleParams ? visibleParams.split(',') : [...possibleFilters]
    const settings = [...new Set(currentVisible)].filter((f) => f !== categoryToHide).join(',')

    url.searchParams.set('visible', settings)
    window.history.pushState({}, null, unescape(url.href))
}

const showCategory = (categoryToShow) => {
    if (typeof window === 'undefined') {
        return
    }
    const url = new URL(window.location.href)
    const currentVisible = new URLSearchParams(url.search).get('visible')?.split(',').filter(Boolean) ||
        [...possibleFilters]
    const settings = [...new Set([categoryToShow, ...currentVisible])]
    const noFilter = possibleFilters.length === settings.length || !settings.length

    noFilter ? url.searchParams.delete('visible') : url.searchParams.set('visible', settings.join(','))
    window.history.pushState({}, null, unescape(url.href))
}

const getSort = (initialSort) => {
    const url = new URL(window.location.href)
    let sort = new URLSearchParams(url.search).get('sort')
    if (!sort) {
        sort = initialSort || 'result'
    }
    return sort
}

const setSort = (type) => {
    const url = new URL(window.location.href)
    url.searchParams.set('sort', type)
    window.history.pushState({}, null, unescape(url.href))
}

const getCollapsedCategory = (renderCollapsed) => {
    let categories
    if (typeof window !== 'undefined') {
        const url = new URL(window.location.href)
        const collapsedItems = new URLSearchParams(url.search).get('collapsed')
        switch (true) {
        case !renderCollapsed && collapsedItems === null:
            categories = ['passed']
            break
        case collapsedItems?.length === 0 || /^["']{2}$/.test(collapsedItems):
            categories = []
            break
        case /^all$/.test(collapsedItems) || collapsedItems === null && /^all$/.test(renderCollapsed):
            categories = [...possibleFilters]
            break
        default:
            categories = collapsedItems?.split(',').map((item) => item.toLowerCase()) || renderCollapsed
            break
        }
    } else {
        categories = []
    }
    return categories
}

const getSortDirection = () => JSON.parse(sessionStorage.getItem('sortAsc')) || false
const setSortDirection = (ascending) => sessionStorage.setItem('sortAsc', ascending)

const getCollapsedIds = () => JSON.parse(sessionStorage.getItem('collapsedIds')) || []
const setCollapsedIds = (list) => sessionStorage.setItem('collapsedIds', JSON.stringify(list))

module.exports = {
    getVisible,
    hideCategory,
    showCategory,
    getCollapsedIds,
    setCollapsedIds,
    getSort,
    setSort,
    getSortDirection,
    setSortDirection,
    getCollapsedCategory,
    possibleFilters,
}

},{}]},{},[4]);
    </script>
  </footer>
</html>